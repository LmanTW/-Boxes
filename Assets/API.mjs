var g=C;function C(t,r){if(r.type==="string")return r.value;if(r.type==="number")return+r.value;if(r.type==="boolean")return r.value==="Yes";if(r.type!=="empty"){if(r.type==="fire")return null;if(r.type==="list")return r.value.map(e=>C(t,e));if(r.type==="actionList")return async(...e)=>await t.runActionList(r.value,e);if(r.type==="externalFunction")return r.value;if(r.type==="promise")return{type:"promise"};throw new Error(`Unsupported Boxes Data Type <${typeof r}>`)}}var c=R;function R(t){if(typeof t=="string")return{type:"string",value:t};if(typeof t=="number")return{type:"number",value:`${t}`};if(typeof t=="boolean")return{type:"boolean",value:t?"Yes":"No"};if(typeof t>"u")return{type:"empty",value:"Empty"};if(t===null)return{type:"fire",value:"Fire"};if(Array.isArray(t))return{type:"list",value:t.map(r=>R(r))};if(typeof t=="function")return{type:"externalFunction",value:t};if(typeof t=="object"&&t.type==="promise")return{type:"promise",value:""};throw new Error(`Unsupported Javascript Data Type <${typeof t}>`)}var w=t=>{let r={};return P(r,t),r};function P(t,r){Object.keys(r).forEach(e=>{typeof r[e]=="object"?(t[e]===void 0&&(t[e]={}),P(t[e],r[e])):t[e]=r[e]})}var x=A;function A(t,r){return t=w(t),r===void 0||Object.keys(r).forEach(e=>{typeof r[e]=="object"?(typeof t[e]!="object"&&(t[e]={}),t[e]=A(t[e],r[e])):t[e]=r[e]}),t}var U=(t,r)=>Math.floor(Math.random()*r)+t;var m=(t,r)=>{r.length===void 0&&(r=[]);let e=E(t);for(;r.includes(e);)e=E(t);return e};function E(t){let r="";for(let e=0;e<t;e++)r+=F[U(0,F.length-1)];return r}var F="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var T=I;function I(t){let r=[];return t.forEach((e,l)=>{Array.isArray(e)?r.push(I(e,l)):r.push(e)}),r}var N=()=>({print:(...t)=>console.log(...t.map(r=>M(r,0))),"String.from":t=>S(t),"String.substring":(t,r,e)=>{if(typeof t!="string")throw`Cannot Perform "Substring" Operation On <${y(t)}>`;if(typeof r!="number")throw`Cannot Perform "Substring" Operation Using <${y(r)}> (start)`;if(typeof e!="number")throw`Cannot Perform "Substring" Operation Using <${y(e)}> (end)`;return data.substring(r,e)},"String.replace":(t,r,e)=>{if(typeof t!="string")throw`Cannot Perform "Replace" Operation On <${y(t)}>`;if(typeof r!="string")throw`Cannot Perform "Replace" Operation Using <${y(r)}> (pattern)`;if(typeof e!="string")throw`Cannot Perform "Replace" Operation Using <${y(e)}> (replacement)`;return t.replaceAll(r,e)},"String.split":(t,r)=>{if(typeof t!="string")throw`Cannot Perform "Split" Operation On <${y(t)}>`;if(typeof r!="string")throw`Cannot Perform "Split" Operation Using <${y(r)}>`;return t.split(r)},"Number.from":t=>{if(typeof t=="string")return isNaN(+t)?void 0:+t;if(typeof t=="number")return t;if(typeof t=="boolean")return+t;if(typeof t>"u"||t===null)return 0;if(Array.isArray(t))return},"Number.toFixed":(t,r)=>{if(typeof t!="number")throw`Cannot Perform "To Fixed" Operation On <${y(t)}>`;if(typeof r!="number")throw`Cannot Perform "To Fixed" Operation Using <${y(r)}> (digits)`;return parseInt(t).toFixed(r)},"List.add":(t,r)=>{if(!Array.isArray(t))throw`Cannot Perform "Add To List" Operation On <${y(t)}>`;return t.concat([r])},"List.insert":(t,r,e)=>{if(!Array.isArray(t))throw`Cannot Perform "Insert To List" Operation On <${y(t)}>`;if(typeof r!="number")throw`Cannot Perform "Insert To List" Operation Using <${y(r)}> (index)`;return t=T(t),t.splice(r,0,e),t},"List.join":(t,r)=>{if(!Array.isArray(t))throw`Cannot Perform "Join" Operation On <${y(t)}>`;if(typeof r!="string")throw`Cannot Perform "Join" Operation Using <${y(r)}>`;return t.join(r)},"Math.PI":3.14,"Math.abs":t=>{if(typeof t!="number")throw`Cannot Perform "Absolute" Operation On <${y(t)}>`;return Math.abs(t)},"Math.ceil":t=>{if(typeof t!="number")throw`Cannot Perform "Ceil" Operation On <${y(t)}>`;return Math.ceil(t)},"Math.cos":t=>{if(typeof t!="number")throw`Cannot Perform "Cosine" Operation On <${y(t)}>`;return Math.cos(t)},"Math.floor":t=>{if(typeof t!="number")throw`Cannot Perform "Floor" Operation On <${y(t)}>`;return Math.floor(t)},"Math.pow":(t,r)=>{if(typeof t!="number")throw`Cannot Perform "Power" Operation On <${y(t)}>`;if(typeof r!="number")throw`Cannot Perform "Power" Operation Using <${y(r)}>`;return Math.pow(t,r)},"Math.random":(t,r)=>{if(typeof t!="number")throw`Cannot Perform "Random" Operation Using <${y(t)}> (min)`;if(typeof r!="number")throw`Cannot Perform "Random" Operation Using <${y(r)}> (max)`;return Math.floor(Math.random()*r)+t},"Math.sin":t=>{if(typeof t!="number")throw`Cannot Perform "Sine" Operation On <${y(t)}>`;return Math.sin(t)},"Math.turnc":t=>{if(typeof t!="number")throw`Cannot Perform "Truncate" Operation On <${y(t)}>`;return Math.trunc(t)},"Timer.wait":async t=>{if(typeof t!="number")throw`Cannot Perform "Wait" Operation Using <${y(t)}>`;return new Promise(r=>{setTimeout(()=>r(),t)})},"Timer.createTimeout":(t,r)=>{if(typeof t!="number")throw`Cannot Perform "Create Timeout" Operation Using <${y(t)}>`;if(typeof r!="function")throw`Cannot Perform "Create Timeout" Operation On <${y(r)}>`;let e=m(5,Object.keys(v));return v[e]=setTimeout(()=>{v[e]!==void 0&&(delete v[e],r())},interval),e},"Timer.createInterval":(t,r)=>{if(typeof t!="number")throw`Cannot Perform "Create Interval" Operation Using <${y(t)}>`;if(typeof r!="function")throw`Cannot Perform "Create Interval" Operation On <${y(r)}>`;let e=m(5,Object.keys(v));return v[e]=setInterval(r,t),e},"Date.now":()=>Date.now()});function M(t,r){if(typeof t=="string")return" ".repeat(r*2)+`"${t}"`;if(typeof t=="number")return" ".repeat(r*2)+t;if(typeof t=="boolean")return" ".repeat(r*2)+(t?"Yes":"No");if(typeof t>"u")return" ".repeat(r*2)+"Empty";if(t===null)return" ".repeat(r*2)+"Fire";if(Array.isArray(t)){if(r>1)return" ".repeat(r*2)+`[Array: ${t.length}]`;{let e=t.map(l=>M(l,r+1));return e.length>99?`${" ".repeat(r*2)}[${e.slice(0,99).join(`,
`)}
... ${t.length-99} More
${" ".repeat(r*2)}]`:`${" ".repeat(r*2)}[
${e.join(`,
`)}
${" ".repeat(r*2)}]`}}if(typeof t=="object"&&t.type==="promise")return" ".repeat(r*2)+"[Promise]"}function S(t){if(["string","number"].includes(typeof t))return t.toString();if(typeof t=="boolean")return t?"Yes":"No";if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return`[${t.map(r=>S(r)).join(",")}]`;if(typeof t=="function")return"[Action List]";if(typeof t=="object"&&t.type==="promise")return"[Promise]"}function y(t){if(["string","number","boolean"].includes(typeof t))return typeof t;if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return"list";if(typeof t=="function")return"actionList";if(typeof t=="object"&&t.type==="promise")return"promise"}var v={};var h=class{#e;#t={};constructor(t){this.#e=t}get chunks(){return this.#t}clear(){this.#t={}}addChunk(t,r,e,l,s,u){let a;t===void 0?a=[]:r===void 0?a=t.callPath:a=t.callPath.concat([r]).slice(0,10);let n=m(5,Object.keys(this.#t));return this.#t[n]={id:n,state:"running",async:s,input:e.input===void 0?{type:"list",value:[],hi:0}:e.input,actions:l,currentAction:0,currentFragment:0,properties:[],result:e.result===void 0?{type:"empty",value:"Empty"}:e.result,lastResult:e.result===void 0?{type:"empty",value:"Empty"}:e.result,returnedResult:void 0,executeData:void 0,parentChunk:t===void 0?void 0:t.id,callPath:a,callback:u},s?t!==void 0&&(t.returnedResult={type:"promise",value:""}):t!==void 0&&(t.state="waiting"),this.#e.addTask(n),n}removeChunk(t){delete this.chunks[t],this.#e.removeTask(t)}};var d=(t,r)=>{let e=[[]];return t.forEach(l=>{r(l)?e.push([]):e[e.length-1].push(l)}),e};var L=(t,r,e,l,s)=>{s?r.returnedResult={type:"promise",value:""}:(r.state="waiting",setTimeout(async()=>{try{let u=await e(...l.map(a=>g(t,a)));r.returnedResult={error:!1,data:c(u)}}catch(u){r.returnedResult={error:!0,content:u.toString()}}r.state="running"},0))};var Y=j;function j(t,r){for(let e=0;e<t.value.length;e++)if(t.value[e].type===r.value[e].type){if(t.value[e].type==="list"){if(!j(t.value[e],r.value[e]))return!1}else if(t.value[e].value!==r.value[e].value)return!1}else return!1;return!0}var b=(t,r,e,l)=>{if(r.length>0){let s=l[t].data;for(let u=0;u<r.length-1;u++)s=s.value[r[u]];e.type==="fire"?s.value.splice(r[r.length-1],1):s.value[r[r.length-1]]=e}else e.type==="fire"?delete l[t]:l[t].data=e};var B=(t,r,e,l,s)=>{let u=e.actions[e.currentAction],a=u[e.currentFragment];if(u.filter(n=>n.type==="operator"&&n.value==="?").length>0){if(e.executeData===void 0){let n={"?":[],":":[]};if(u.forEach((p,f)=>{p.type==="operator"&&(p.value==="?"?n["?"].push({data:p,index:f}):p.value===":"&&n[":"].push({data:p,index:f}))}),n["?"].length>1)return{error:!0,content:"Unexpected <operator>",line:n["?"][0].data.line,start:n["?"][0].data.start};if(n[":"].length>1)return{error:!0,content:"Unexpected <operator>",line:n[":"][0].data.line,start:n[":"][0].data.start};if(u[n["?"][0].index-1]===void 0)return{error:!0,content:"Expecting <anything>",line:n["?"][0].data.line,start:0};if(u[n["?"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>",line:u[n["?"][0].index].line,start:u[n["?"][0].index].end};if(u[n["?"][0].index+1].type!=="actionList")return{error:!0,content:`Unexpected <${u[n["?"][0].index+1].type}>`,line:u[n["?"][0].index+1].line,start:u[n["?"][0].index+1].start};if(n[":"].length>0&&u[n[":"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>"};let o=d(u,p=>p.type==="operator"&&(p.value==="?"||p.value===":"));return o[1].length>1?{error:!0,content:`Unexpected <${o[1][1].type}>`,line:o[1][1].line,start:o[1][1].start}:o.length>2&&o[2].length>1?{error:!0,content:`Unexpected <${o[2][1].type}>`,line:o[2][1].line,start:o[2][1].start}:(e.executeData={type:"gettingCondition",condition:o[0],chunks:o.slice(1,o.length).map(p=>p[0])},r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.condition],!1),{error:!1})}else if(e.executeData.type==="gettingCondition"){if(e.returnedResult.type!=="boolean")return{error:!0,content:`Can Not Perform "If" Operation Using <${e.returnedResult.type}>`,line:e.returnedResult.line,start:e.returnedResult.start};if(e.returnedResult.value==="Yes")return e.executeData.type="waitingActions",r.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[0].value,!1),{error:!1};if(e.executeData.chunks.length>1)return e.executeData.type="waitingActions",r.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[1].value,!1),{error:!1}}else e.executeData.type==="waitingActions"&&(e.result=e.returnedResult);e.currentFragment=u.length,e.executeData=void 0}else if(u.filter(n=>n.type==="operator"&&["=","||","&&","==",">","<","+","-","*","/"].includes(n.value)).length>0)if(e.executeData===void 0){let n;for(let p of["=","||","&&","==",">","<",">=","<=","+","-","*","/"])if(u.filter(f=>f.type==="operator"&&f.value===p).length>0){n=p;break}let o=u.filter(p=>p.type==="operator"&&p.value===n);return o.length>1?{error:!0,content:"Unexpected <operator>",line:o[1].line,start:o[1].start}:(e.executeData={type:n,chunks:d(u,p=>p.type==="operator"&&p.value===n),returnedResults:[]},r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[0]],!1),{error:!1})}else if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=e.executeData.chunks.length){let n=e.executeData.returnedResults;if(e.executeData.type==="="){if(n[0].name===void 0)return{error:!0,content:`<${n[0].type}> Is Not In A Box`,line:n[0].line,start:n[0].start};if(l[n[0].name].lock)return{error:!0,content:`Box Is Locked: "${n[0].name}"`,line:n[0].line,start:n[0].start};b(n[0].name,n[0].path,n[1],l),e.result=n[1]}else if(e.executeData.type==="||"||e.executeData.type==="&&"){if(n[0].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation On <${n[0].type}>`,line:n[0].line,start:n[0].start};if(n[1].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation Using <${n[1].type}>`,line:n[1].line,start:n[1].start};e.result={type:"boolean",value:(e.executeData.type==="||"?n[0].value==="Yes"||n[1].value==="Yes":n[0].value==="Yes"&&n[1].value==="Yes")?"Yes":"No",line:n[0].line,start:n[0].start,end:n[1].end}}else if(e.executeData.type==="==")n[0].type!==n[1].type&&(e.result={type:"boolean",value:"no",line:n[0].line,start:n[0].start,end:n[1].end}),n[0].type==="list"?e.result={type:"boolean",value:Y(n[0],n[1])?"yes":"no",line:n[0].line,start:n[0].start,end:n[1].end}:e.result={type:"boolean",value:n[0].value===n[1].value?"yes":"no",line:n[0].line,start:n[0].start,end:n[1].end};else if([">","<",">=","<="].includes(e.executeData.type)){let o;if(e.executeData.type===">"?o="More Than":e.executeData.type==="<"?o="Less Than":e.executeData.type===">="?o="More Than Or Equal To":e.executeData.type==="<="&&(o="Less Than Or Equal To"),n[0].type!=="number")return{error:!0,content:`Cannot Perform "${o}" Operation On <${n[0].type}>`,line:n[0].line,start:n[0].start};if(n[1].type!=="number")return{error:!0,content:`Cannot Perform "${o}" Operation On <${n[1].type}>`,line:n[1].line,start:n[1].start};let p;e.executeData.type===">"?p=+n[0].value>+n[1].value:e.executeData.type==="<"?p=+n[0].value<+n[1].value:e.executeData.type===">="?p=+n[0].value>=+n[1].value:e.executeData.type==="<="&&(p=+n[0].value<=+n[1].value),e.result={type:"boolean",value:p?"Yes":"No",line:n[0].line,start:n[0].start,end:n[1].end}}else if(e.executeData.type==="+"){if(n[0].type!=="string"&&n[0].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation On <${n[0].type}>`,line:n[0].line,start:n[0].start};if(n[1].type!=="string"&&n[1].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation Using <${n[1].type}>`,line:n[1].line,start:n[1].start};n[0].type==="string"||n[1].type==="string"?e.result={type:"string",value:n[0].value+n[1].value,line:n[0].line,start:n[0].start,end:n[1].end}:e.result={type:"number",value:`${+n[0].value+ +n[1].value}`,line:n[0].line,start:n[0].start,end:n[1].end}}else if(e.executeData.type==="*"){if(n[0].type!=="string"&&n[0].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation On <${n[0].type}>`,line:n[0].line,start:n[0].start};if(n[1].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation Using <${n[1].type}>`,line:n[1].line,start:n[1].start};if(n[0].type==="string"){if(+n[1].value<0)return{error:!0,content:'Cannot Perform "String Multiply" Using <number> Less Than 0',line:n[1].line,start:n[1].start};e.result={type:"string",value:n[0].value.repeat(+n[1].value),line:n[0].line,start:n[0].start,end:n[1].end}}else e.result={type:"number",value:+n[0].value*+n[1].value,line:n[0].line,start:n[0].start,end:n[1].end}}else if(["-","/"].includes(e.executeData.type)){if(n[0].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation On <${n[0].type}>`,line:n[0].line,start:n[0].start};if(n[1].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation Using <${n[1].type}>`,line:n[1].line,start:n[1].start};let o=e.executeData.type==="-"?+n[0].value-+n[1].value:+n[0].value/+n[1].value;o===1/0?e.result={type:"empty",value:"Empty",line:n[0].line,start:n[0].start,end:n[1].start}:e.result={type:"number",value:`${o}`,line:n[0].line,start:n[0].start,end:n[1].end}}e.currentFragment=u.length,e.executeData=void 0}else return r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[e.executeData.returnedResults.length]],!1),{error:!1};else if(a.type==="operator"&&a.value==="!"){if(e.executeData===void 0)return e.executeData=!0,r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[u.slice(e.currentFragment+1,u.length)],!1),{error:!1};if(e.returnedResult.type!=="boolean")return{error:!0,content:`Cannot Perform "Not" Operation On <${e.returnedResult.type}>`,line:a.line,start:a.line};e.result={type:"boolean",value:e.returnedResult.value==="Yes"?"No":"Yes",line:a.line,start:a.start,end:e.returnedResult.end},e.currentFragment=u.length}else if(a.type==="operator"&&a.value==="~")e.properties.push("async");else if(["string","number","boolean","empty","fire","actionList"].includes(a.type)){if(u.length>e.currentFragment+1)return{error:!0,content:`Unexpected <${u[e.currentFragment+1].type}>`,line:u[e.currentFragment+1].line,start:u[e.currentFragment+1].start};e.result=a}else if(a.type==="name"){if(!["Result","Input"].includes(a.value)&&l[a.value]===void 0&&s[a.value]===void 0)return{error:!0,content:`Box Not Found: "${a.value}"`,line:a.line,start:a.start};let n;a.value==="Result"?n={type:e.lastResult.type,value:e.lastResult.value,line:a.line,start:a.start,end:a.end,name:a.value,path:[]}:a.value==="Input"?n={type:e.input.type,value:e.input.value,line:a.line,start:a.start,end:a.end,name:a.value,path:[]}:n=l[a.value]===void 0?s[a.value]:l[a.value].data,e.result={type:n.type,value:n.value,line:n.line,start:n.start,end:n.end,name:a.value,path:[]}}else if(a.type==="list"||a.type==="inputList"){if(e.executeData===void 0){if(u[e.currentFragment+1]!==void 0&&u[e.currentFragment+1].type!=="inputList")return{error:!0,content:`Unexpected <${u[e.currentFragment+1].type}>`,line:u[e.currentFragment+1].line,start:u[e.currentFragment+1].start};if(e.executeData={state:"gettingItems",returnedResults:[]},a.value.length>0)r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[a.value[0]],!1);else{if(e.result.type==="list")return{error:!0,content:'Cannot Perform "Read" Operation Using <empty>'};e.returnedResult={type:"empty",value:"Empty",line:a.line,start:a.start,end:a.end}}return{error:!1}}else if(e.executeData.state==="gettingItems")if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=a.value.length)if(a.type==="list")e.result={type:"list",value:e.executeData.returnedResults,line:a.line,start:a.start,end:a.end};else{if(e.result.type!=="list"&&e.result.type!=="actionList"&&e.result.type!=="externalFunction")return{error:!0,content:`cannot perform "read" operation on <${e.result.type}>`};if(e.result.type==="list"){if(e.executeData.returnedResults[0].type!=="number"&&e.executeData.returnedResults[0].type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation Using <${e.executeData.returnedResults[0].type}>`,line:a.line,start:a.start};let n=e.result;if(e.executeData.returnedResults[0].type==="number")n=n.value[e.executeData.returnedResults[0].value];else for(let o of e.executeData.returnedResults[0].value){if(n===void 0||n.type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation On <${n===void 0?"empty":n.type}>`,line:o.line,start:o.start};if(o.type!=="number")return{error:!0,content:`Cannot Perform "Read" Operation Using <${o.type}>`,line:o.line,start:o.start};n=n.value[o.value]}n===void 0?(e.result.type="empty",e.result.value="Empty"):(e.result.type=n.type,e.result.value=n.value),e.result.end=a.end,e.result.path&&e.result.path.push(e.executeData.returnedResults[0].value)}else{if(e.result.type==="actionList")return e.executeData.state="waitingActions",r.addChunk(e,{line:a.line},{input:{type:"list",value:e.executeData.returnedResults}},e.result.value,e.properties.includes("async")),{error:!1};if(e.result.type==="externalFunction")return e.executeData.state="waitingExternalFunction",L(t,e,e.result.value,e.executeData.returnedResults,e.properties.includes("async")),{error:!1}}}else return r.addChunk(e,void 0,{result:e.lastResult,input:e.input},[a.value[e.executeData.returnedResults.length]]),{error:!1};else if(e.executeData.state==="waitingActions")e.result=e.returnedResult;else if(e.executeData.state==="waitingExternalFunction"){if(e.returnedResult.error)return{error:!0,content:e.returnedResult.content,line:a.line,start:a.start};e.result={type:e.returnedResult.data.type,value:e.returnedResult.data.value,line:a.line,start:a.start}}e.executeData=void 0}else return{error:!0,content:`Unexpected <${a.type}>`,line:a.line,start:a.start};if(e.currentFragment>=u.length-1)if(e.currentFragment=0,e.currentAction>=e.actions.length-1){let n=r.chunks[e.parentChunk];!e.async&&n!==void 0&&(n.state="running",n.returnedResult=e.result),r.removeChunk(e.id),e.callback!==void 0&&e.callback(e.result)}else e.currentAction++,e.properties=[],e.lastResult=e.result;else e.currentFragment++;return{error:!1}};var $=class{#e=[];#t=0;get tasks(){return this.#e}clear(){this.#e=[],this.#t=0}addTask(t){this.#e.push(t)}removeTask(t){for(;this.#e.includes(t);)this.#e.splice(this.#e.indexOf(t),1)}nextTask(){let t=this.#e[this.#t];return this.#t++,this.#t>=this.#e.length&&(this.#t=0),t}};var J=(t,r,e)=>{let l=[],s=0;if(t[0].type==="operator"&&t[0].value==="+"&&(l.push("create"),t[1].type==="operator"&&t[1].value==="@"?(l.push("lock"),s+=2):s++),t[s]===void 0)return{error:!0,content:"Expecting A <name>",line:t.line,start:0};if(t[s].type!=="name")return{error:!0,content:`Unexpect <${t[s].type}>`,line:t[s].line,start:t[s].start};let u=t[s].value,a=[];if(l.includes("create")){if(t[s+1]!==void 0)return{error:!0,content:`Unexpect <${t[s+1].type}>`,line:t[s+1].line,start:t[s+1].start};if(e[u]!==void 0)return{error:!0,content:`Box Named "${u}" Already Exist (Environment Box)`,line:t[s].line,start:t[s].start};if(r[u]!==void 0)return{error:!0,content:`Box Names "${u}" Already Exist`,line:t[s].line,start:t[s].start};r[u]={lock:l.includes("lock"),data:{type:"empty",value:"Empty"}}}else{if(t[s+1]!==void 0&&t[s+1].type!=="inputList")return{error:!0,content:`Unexpected <${t[s+1].typ}>`,line:t[s+1].line,start:t[s+1].start};if(e[u]!==void 0)return{error:!0,content:`Box Is Locked: "${u}" (Environment Box)`,line:t[s].line,start:t[s].start};if(r[u]===void 0)return{error:`Box Not Found: "${u}"`};if(t[s+1]!==void 0&&t[s+1].type==="inputList"){let o=function(p){if(n===void 0||n.type!=="list")return{error:!0,content:`Cannot Perform "read" Operation On <${n===void 0?"empty":n.type}>`,line:t[s].line,start:t[s].start};if(p.value.length<1)return{error:!0,content:"Expecting A <number>",line:t[s].line,start:t[s].start+1};if(p.value.length>1)return{error:!0,content:`Unexpected <${p.value[1][0].type}>`,line:t[s].value[1][0].line,start:p.value[1][0].start};for(let f of p.value){if(f[0].type!=="number"&&f[0].type!=="name"&&f[0].type!=="list")return{error:!0,content:`Unexpected <${f[0].type}>`,line:f[0].line,start:f[0].start};if(f.length>1)return{error:!0,content:`Unexpected <${f[1].type}>`,line:f[1].line,start:f[1].start}}if(p.value[0][0].type==="number")a.push(p.value[0][0].value),n=n.value[p.value[0][0].value];else if(p.value[0][0].type==="name"){if(r[p.value[0][0].value]===void 0&&e[p.value[0][0].value]===void 0)return{error:!0,content:`Box Not Found: "${p.value[0][0].value}"`,line:p.value[0][0].line,start:p.value[0][0].start};let f=r[p.value[0][0].value]===void 0?e[p.value[0][0].value].data:r[p.value[0][0].value].data;return o({type:"inputList",value:[[f]]})}else for(let f of p.value[0][0].value){if(n.type!=="list")return{error:`Cannot Perform "read" Operation On <${n.type}>`};if(Array.isArray(f)){if(f[0].type!=="number")return{error:!0,content:`Unexpected <${f[0].type}>`,line:f[0].line,start:f[0].start};if(f.length>1)return{error:!0,content:`Unexpected <${f[1].type}>`,line:f[1].line,start:f[1].start};a.push(f[0].value),n=n.value[f[0].value]}else{if(f.type!=="number")return{error:!0,content:`Unexpected <${f.type}>`,line:f.line,start:f.start};a.push(f.value),n=n.value[f.value]}}return{error:!1}};if(r[u].data.type!=="list")return{error:`Cannot Perform "Read" Operation On <${r[u].data.type}>`};s++;let n=r[u].data;for(;t[s]!==void 0&&t[s].type==="inputList";){let p=o(t[s]);if(p.error)return p;s++}}}return{error:!1,name:u,path:a}};var O=class{#e={};#t;#n="idle";#l=new $;#i=new h(this.#l);#r={};#a;#u;#s;constructor(t,r){t=x(N(),t),Object.keys(t).forEach(e=>{if(["Result","Input"].includes(e))throw new Error(`Box Name "${e}" Is Reserved`);this.#e[e]=c(t[e])}),this.#t=x({chunkPerExecution:100,executionInterval:0,keepRunning:!1},r)}get boxes(){return this.#s}async start(t){if(this.#n==="idle")return new Promise(r=>{this.#n="running",this.#l.clear(),this.#i.clear(),this.#s={},this.#r={operations:t,currentOperation:0,globalChunk:this.#i.addChunk(void 0,{name:"<global>"},{},t[0].source,!1),result:{type:"empty",value:"Empty"}},this.#a=setInterval(()=>this.#o(),this.#t.executionInterval),this.#u=r});if(this.#n==="paused")this.#a=setInterval(()=>this.#o(),this.#t.executionInterval);else throw new Error(`Cannot Start Virtual Machine (State: ${this.#n})`)}pause(){if(this.#n==="running")this.#n="paused",clearInterval(this.#a);else throw new Error(`Cannot Pause Virtual Machine (State: ${this.#n})`)}async runActionList(t,r){if(this.#n==="running")return new Promise(e=>{this.#i.addChunk(void 0,void 0,{input:c(r)},t,!1,l=>e(g(this,l)))});throw new Error(`Cannot Run Action List (State: ${this.#n})`)}#o(){for(let t=0;t<this.#t.chunkPerExecution;t++)if(this.#l.tasks.length>0){let r=this.#i.chunks[this.#l.nextTask()];if(r===void 0&&(r=this.#i.chunks[this.#l.nextTask()]),r.state==="running"){let e=B(this,this.#i,r,this.#s,this.#e);if(e.error){this.#n="idle",clearInterval(this.#a),this.#u(e);break}this.#r.result=r.result}if(this.#i.chunks[this.#r.globalChunk]===void 0&&this.#r.currentOperation<this.#r.operations.length-1){let e=J(this.#r.operations[this.#r.currentOperation].target,this.#s,x(this.#e,{Result:r.result,Input:r.input}),this.#r.operations[this.#r.currentOperation].line);if(e.error){this.#n="idle",clearInterval(this.#a),this.#u(e);break}b(e.name,e.path,r.result,this.#s),this.#r.currentOperation++,this.#r.globalChunk=this.#i.addChunk(void 0,{name:"<global>"},{},this.#r.operations[this.#r.currentOperation].source,!1)}}else if(!this.#t.keepRunning){this.#n="idle",clearInterval(this.#a),this.#u(this.#r.result);break}}};var V=(t,r)=>{let e=[],l={},s=0;for(let a=0;a<t.length;a++)if(t[a]==="#"){if(l.type!=="string")return l.type!==void 0&&e.push({type:l.type,value:l.value,line:r,start:l.start,end:a}),{error:!1,fragments:e}}else if(t[a]===" ")l.type!==void 0&&l.type!=="string"&&(e.push({type:l.type,value:l.value,line:r,start:l.start,end:a}),l={});else if("[{(".includes(t[a]))l.type!=="string"&&(l.type!==void 0&&(e.push({type:l.type,value:l.value,line:r,start:l.start,end:a}),l={}),e.push({type:"bracket",value:t[a],line:r,start:a,end:a,layer:s}),s++);else if("]})".includes(t[a]))l.type!=="string"&&(l.type!==void 0&&(e.push({type:l.type,value:l.value,line:r,start:l.start,end:a}),l={}),s--,e.push({type:"bracket",value:t[a],line:r,start:a,end:a,layer:s}));else if(l.type===void 0){let n=a;if(t[a]==="'"||t[a]==='"')l={type:"string",bracket:t[a],value:"",line:r,start:n};else if("0123456789".includes(t[a]))l={type:"number",value:t[a],line:r,start:n};else if(t.substring(a,a+3)==="Yes"||t.substring(a,a+2)==="No"){let o=t.substring(a,a+3)==="Yes"?"Yes":"No";e.push({type:"boolean",value:o,line:r,start:n,end:a+o.length-1}),a+=o.length-1}else t.substring(a,a+5)==="Empty"?(e.push({type:"empty",value:"Empty",line:r,start:n,end:a+4}),a+=4):t.substring(a,a+4)==="Fire"?(e.push({type:"fire",value:"Fire",line:r,start:n,end:a+3}),a+=3):q.includes(t.substring(a,a+2))?(e.push({type:"operator",value:t.substring(a,a+2),line:r,start:n,end:a+1}),a++):q.includes(t[a])?e.push({type:"operator",value:t[a],line:r,start:n,end:a,layer:s}):l={type:"name",value:t[a],line:r,start:a}}else l.type==="string"?t[a]===l.bracket?(e.push({type:"string",value:l.value,line:r,start:l.start,end:a}),l={}):l.value+=t[a]:l.type==="number"?"0123456789.".includes(t[a])?l.value+=t[a]:(e.push({type:"number",value:l.value,line:r,start:l.start,end:a-1}),l={},a--):l.type==="name"&&("+-*/~@!=><|&?:,".includes(t[a])?(e.push({type:"name",value:l.value,line:r,start:l.start,end:a-1}),l={},a--):l.value+=t[a]);if(l.type!==void 0){if(l.type==="string")return{error:!0,content:"<string> Cannot Be Closed",line:r,start:l.start};e.push({type:l.type,value:l.value,line:r,start:l.start,end:t.length-1})}let u=[];for(let a=0;a<e.length;a++)if(e[a].type==="operator"&&e[a].value==="-"&&e[a+1]!==void 0&&e[a+1].type==="number"&&e[a-1]===void 0){for(let n=1;n<e[1].value.length-1;n++)if(e[1].value[n]==="."&&e[1].value[n-1]===".")return{error:!0,content:'Unexpected "."',line:r,start:n};u.push({type:"number",value:`-${e[a+1].value}`,line:r,start:e[a].start,end:e[a+1].end}),a++}else if(e[a].type==="number"){for(let n=1;n<e[0].value.length-1;n++)if(e[0].value[n]==="."&&e[0].value[n-1]===".")return{error:!0,content:'Unexpected "."',line:r,start:n};u.push(e[a])}else u.push(e[a]);return{error:!1,fragments:u}},q=["+","-","*","/","~","@","!","=","==","<",">",">=","<=","||","&&","?",":","<-","->",",","|"];var W=z;function z(t,r){let e=[],l={};for(let s=0;s<t.length;s++)if(l.type===void 0)if(t[s].type==="bracket"&&t[s].value==="[")l={type:"list",bracket:"]",value:[],start:t[s].start,layer:t[s].layer};else if(t[s].type==="bracket"&&t[s].value==="{")l={type:"actionList",bracket:"}",value:[],start:t[s].start,layer:t[s].layer};else if(t[s].type==="bracket"&&t[s].value==="(")l={type:"inputList",bracket:")",value:[],start:t[s].start,layer:t[s].layer};else{if(t[s].type==="bracket")return{error:!0,content:"Unexpected <braket>",line:r,start:t[s].start};e.push(t[s])}else if(t[s].type==="bracket"&&t[s].value===l.bracket&&t[s].layer===l.layer){let u=l.type==="list"||l.type==="inputList"?",":"|";for(let a=1;a<l.value.length;a++)if(l.value[a].type==="operator"&&l.value[a].value===u&&l.value[a].layer===l.layer+1&&l.value[a-1].type!==void 0&&l.value[a-1].type==="operator"&&l.value[a-1].value===u&&l.value[a-1].layer===l.layer+1)return{error:!0,content:`Unexpected "${u}"`,line:r,start:l.value[a].start};if(l.value.length>0){if(l.value[l.value.length-1].type==="operator"&&l.value[l.value.length-1].value===u&&l.value[l.value.length-1].layer===l.layer+1)return{error:!0,content:`Unexpected "${u}"`,line:r,start:l.value[l.value.length-1].start};let a=d(l.value,n=>n.type==="operator"&&n.value===u&&n.layer===l.layer+1);for(let n=0;n<a.length;n++){let o=z(a[n],r);if(o.error)return o;a[n]=o.fragments}e.push({type:l.type,value:a,line:r,start:l.start,end:s})}else e.push({type:l.type,value:[],line:r,start:l.start,end:s});l={}}else l.value.push(t[s]);return l.type!==void 0?{error:!0,content:`<${l.type}> Cannot Be Closed`,line:r,start:l.start}:{error:!1,fragments:e}}var G=t=>{let r=[],e={};if(string[i]==="#"){if(e.type!=="string")return e.type!==void 0&&r.push({type:e.type,line:t,start:e.start,end:i}),r.push({type:"comment",line:t,start:i,end:t.length-1}),r}else if(string[i]===" ")e.type!==void 0&&e.type!=="string"&&(r.push({type:e.type,line:t,start:e.start,end:i}),e={});else if("[{(".includes(string[i]))e.type!=="string"&&(e.type!==void 0&&(r.push({type:e.type,line:t,start:e.start,end:i}),e={}),r.push({type:"bracket",line:t,start:i,end:i,layer}),layer++);else if("]})".includes(string[i]))e.type!=="string"&&(e.type!==void 0&&(r.push({type:e.type,line:t,start:e.start,end:i}),e={}),layer--,r.push({type:"bracket",line:t,start:i,end:i,layer}));else if(e.type===void 0){let s=i;if(string[i]==="'"||string[i]==='"')e={type:"string",bracket:string[i],line:t,start:s};else if("0123456789".includes(string[i]))e={type:"number",line:t,start:s};else if(string.substring(i,i+3)==="Yes"||string.substring(i,i+2)==="No"){let u=string.substring(i,i+3)==="Yes"?"Yes":"No";r.push({type:"boolean",line:t,start:s,end:i+u.length-1}),i+=u.length-1}else string.substring(i,i+5)==="Empty"?(r.push({type:"empty",line:t,start:s,end:i+4}),i+=4):string.substring(i,i+4)==="Fire"?(r.push({type:"fire",line:t,start:s,end:i+3}),i+=3):operators.includes(string.substring(i,i+2))?(r.push({type:"operator",line:t,start:s,end:i+1}),i++):operators.includes(string[i])?r.push({type:"operator",line:t,start:s,end:i,layer}):e={type:"name",line:t,start:i}}else e.type==="string"?string[i]===e.bracket&&(r.push({type:"string",line:t,start:e.start,end:i}),e={}):e.type==="number"?"0123456789.".includes(string[i])||(r.push({type:"number",line:t,start:e.start,end:i-1}),e={},i--):e.type==="name"&&"+-*/~@!=><|&?:,".includes(string[i])&&(r.push({type:"name",line:t,start:e.start,end:i-1}),e={},i--);e.type!==void 0&&e.type!=="string"&&r.push({type:e.type,value:e.value,line:t,start:e.start,end:string.length-1});let l=[];for(let s=0;s<r.length;s++)r[s].type==="operator"&&r[s].value==="-"&&r[s+1]!==void 0&&r[s+1].type==="number"&&r[s-1]===void 0?(l.push({type:"number",line:t,start:r[s].start,end:r[s+1].end}),s++):l.push(r[s]);return r};var D=class{static compile(t){let r=[],e=t.split(`
`);for(let l=0;l<e.length;l++){let s=V(e[l],l+1);if(s.error)return s;if(s.fragments.length>0){if(s=W(s.fragments,l+1),s.error)return s;let u=s.fragments.filter(o=>o.type==="operator"&&(o.value==="<-"||o.value==="->"));if(u<1)return{error:!0,content:"Cannot Found Any Direction",line:l+1};if(u>1)return{error:!0,content:"Too Many Directions",line:l+1};let a=s.fragments.filter(o=>o.type==="operator"&&o.value==="<-").length>0?"<-":"->",n=d(s.fragments,o=>o.type==="operator"&&o.value===a);a==="<-"?r.push({target:n[0],source:d(n[1],o=>o.type==="operator"&&o.value==="|").filter(o=>o.length>0),line:l+1}):r.push({target:n[1],source:d(n[0],o=>o.type==="operator"&&o.value==="|").filter(o=>o.length>0),line:l+1})}}return{error:!1,operations:r}}static highlight(t){let r=[];return t.split(`
`).forEach(e=>r=r.concat(G(e))),r}};export{D as Compiler,O as VirtualMachine};
