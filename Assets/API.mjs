var m=D;function D(t,n){if(n.type==="string")return n.value;if(n.type==="number")return+n.value;if(n.type==="boolean")return n.value==="Yes";if(n.type!=="empty"){if(n.type==="fire")return null;if(n.type==="list")return n.value.map(e=>D(t,e));if(n.type==="actionList")return async(...e)=>await t.runActionList(n.value,e);if(n.type==="externalFunction")return n.value;if(n.type==="promise")return{type:"promise"};throw new Error(`Unsupported Boxes Data Type <${typeof n}>`)}}var v=C;function C(t){if(typeof t=="string")return{type:"string",value:t};if(typeof t=="number")return{type:"number",value:`${t}`};if(typeof t=="boolean")return{type:"boolean",value:t?"Yes":"No"};if(typeof t>"u")return{type:"empty",value:"Empty"};if(t===null)return{type:"fire",value:"Fire"};if(Array.isArray(t))return{type:"list",value:t.map(n=>C(n))};if(typeof t=="function")return{type:"externalFunction",value:t};if(typeof t=="object"&&t.type==="promise")return{type:"promise",value:""};throw new Error(`Unsupported Javascript Data Type <${typeof t}>`)}var R=t=>{let n={};return w(n,t),n};function w(t,n){Object.keys(n).forEach(e=>{typeof n[e]=="object"?(t[e]===void 0&&(t[e]={}),w(t[e],n[e])):t[e]=n[e]})}var x=P;function P(t,n){return t=R(t),n===void 0||Object.keys(n).forEach(e=>{typeof n[e]=="object"?(typeof t[e]!="object"&&(t[e]={}),t[e]=P(t[e],n[e])):t[e]=n[e]}),t}var A=(t,n)=>Math.floor(Math.random()*n)+t;var c=(t,n)=>{n.length===void 0&&(n=[]);let e=U(t);for(;n.includes(e);)e=U(t);return e};function U(t){let n="";for(let e=0;e<t;e++)n+=E[A(0,E.length-1)];return n}var E="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var F=T;function T(t){let n=[];return t.forEach((e,i)=>{Array.isArray(e)?n.push(T(e,i)):n.push(e)}),n}var I=()=>({print:(...t)=>console.log(...t.map(n=>N(n,0))),"String.from":t=>M(t),"String.substring":(t,n,e)=>{if(typeof t!="string")throw`Cannot Perform "Substring" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Substring" Operation Using <${f(n)}> (start)`;if(typeof e!="number")throw`Cannot Perform "Substring" Operation Using <${f(e)}> (end)`;return data.substring(n,e)},"String.replace":(t,n,e)=>{if(typeof t!="string")throw`Cannot Perform "Replace" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Replace" Operation Using <${f(n)}> (pattern)`;if(typeof e!="string")throw`Cannot Perform "Replace" Operation Using <${f(e)}> (replacement)`;return t.replaceAll(n,e)},"String.split":(t,n)=>{if(typeof t!="string")throw`Cannot Perform "Split" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Split" Operation Using <${f(n)}>`;return t.split(n)},"Number.from":t=>{if(typeof t=="string")return isNaN(+t)?void 0:+t;if(typeof t=="number")return t;if(typeof t=="boolean")return+t;if(typeof t>"u"||t===null)return 0;if(Array.isArray(t))return},"Number.toFixed":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "To Fixed" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "To Fixed" Operation Using <${f(n)}> (digits)`;return parseInt(t).toFixed(n)},"List.add":(t,n)=>{if(!Array.isArray(t))throw`Cannot Perform "Add To List" Operation On <${f(t)}>`;return t.concat([n])},"List.insert":(t,n,e)=>{if(!Array.isArray(t))throw`Cannot Perform "Insert To List" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Insert To List" Operation Using <${f(n)}> (index)`;return t=F(t),t.splice(n,0,e),t},"List.join":(t,n)=>{if(!Array.isArray(t))throw`Cannot Perform "Join" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Join" Operation Using <${f(n)}>`;return t.join(n)},"Math.PI":3.14,"Math.abs":t=>{if(typeof t!="number")throw`Cannot Perform "Absolute" Operation On <${f(t)}>`;return Math.abs(t)},"Math.ceil":t=>{if(typeof t!="number")throw`Cannot Perform "Ceil" Operation On <${f(t)}>`;return Math.ceil(t)},"Math.cos":t=>{if(typeof t!="number")throw`Cannot Perform "Cosine" Operation On <${f(t)}>`;return Math.cos(t)},"Math.floor":t=>{if(typeof t!="number")throw`Cannot Perform "Floor" Operation On <${f(t)}>`;return Math.floor(t)},"Math.pow":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Power" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Power" Operation Using <${f(n)}>`;return Math.pow(t,n)},"Math.random":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Random" Operation Using <${f(t)}> (min)`;if(typeof n!="number")throw`Cannot Perform "Random" Operation Using <${f(n)}> (max)`;return Math.floor(Math.random()*n)+t},"Math.sin":t=>{if(typeof t!="number")throw`Cannot Perform "Sine" Operation On <${f(t)}>`;return Math.sin(t)},"Math.turnc":t=>{if(typeof t!="number")throw`Cannot Perform "Truncate" Operation On <${f(t)}>`;return Math.trunc(t)},"Timer.wait":async t=>{if(typeof t!="number")throw`Cannot Perform "Wait" Operation Using <${f(t)}>`;return new Promise(n=>{setTimeout(()=>n(),t)})},"Timer.createTimeout":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Create Timeout" Operation Using <${f(t)}>`;if(typeof n!="function")throw`Cannot Perform "Create Timeout" Operation On <${f(n)}>`;let e=c(5,Object.keys(d));return d[e]=setTimeout(()=>{d[e]!==void 0&&(delete d[e],n())},interval),e},"Timer.createInterval":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Create Interval" Operation Using <${f(t)}>`;if(typeof n!="function")throw`Cannot Perform "Create Interval" Operation On <${f(n)}>`;let e=c(5,Object.keys(d));return d[e]=setInterval(n,t),e},"Date.now":()=>Date.now()});function N(t,n){if(typeof t=="string")return" ".repeat(n*2)+`"${t}"`;if(typeof t=="number")return" ".repeat(n*2)+t;if(typeof t=="boolean")return" ".repeat(n*2)+(t?"Yes":"No");if(typeof t>"u")return" ".repeat(n*2)+"Empty";if(t===null)return" ".repeat(n*2)+"Fire";if(Array.isArray(t)){if(n>1)return" ".repeat(n*2)+`[Array: ${t.length}]`;{let e=t.map(i=>N(i,n+1));return e.length>99?`${" ".repeat(n*2)}[${e.slice(0,99).join(`,
`)}
... ${t.length-99} More
${" ".repeat(n*2)}]`:`${" ".repeat(n*2)}[
${e.join(`,
`)}
${" ".repeat(n*2)}]`}}if(typeof t=="object"&&t.type==="promise")return" ".repeat(n*2)+"[Promise]"}function M(t){if(["string","number"].includes(typeof t))return t.toString();if(typeof t=="boolean")return t?"Yes":"No";if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return`[${t.map(n=>M(n)).join(",")}]`;if(typeof t=="function")return"[Action List]";if(typeof t=="object"&&t.type==="promise")return"[Promise]"}function f(t){if(["string","number","boolean"].includes(typeof t))return typeof t;if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return"list";if(typeof t=="function")return"actionList";if(typeof t=="object"&&t.type==="promise")return"promise"}var d={};var h=class{#e;#t={};constructor(t){this.#e=t}get chunks(){return this.#t}clear(){this.#t={}}addChunk(t,n,e,i,s,l){let a;t===void 0?a=[]:n===void 0?a=t.callPath:a=t.callPath.concat([n]).slice(0,10);let r=c(5,Object.keys(this.#t));return this.#t[r]={id:r,state:"running",async:s,input:e.input===void 0?{type:"list",value:[],hi:0}:e.input,actions:i,currentAction:0,currentFragment:0,properties:[],result:e.result===void 0?{type:"empty",value:"Empty"}:e.result,lastResult:e.result===void 0?{type:"empty",value:"Empty"}:e.result,returnedResult:void 0,executeData:void 0,parentChunk:t===void 0?void 0:t.id,callPath:a,callback:l},s?t!==void 0&&(t.returnedResult={type:"promise",value:""}):t!==void 0&&(t.state="waiting"),this.#e.addTask(r),r}removeChunk(t){delete this.chunks[t],this.#e.removeTask(t)}};var y=(t,n)=>{let e=[[]];return t.forEach(i=>{n(i)?e.push([]):e[e.length-1].push(i)}),e};var S=(t,n,e,i,s)=>{s?n.returnedResult={type:"promise",value:""}:(n.state="waiting",setTimeout(async()=>{try{let l=await e(...i.map(a=>m(t,a)));n.returnedResult={error:!1,data:v(l)}}catch(l){n.returnedResult={error:!0,content:l.toString()}}n.state="running"},0))};var L=Y;function Y(t,n){for(let e=0;e<t.value.length;e++)if(t.value[e].type===n.value[e].type){if(t.value[e].type==="list"){if(!Y(t.value[e],n.value[e]))return!1}else if(t.value[e].value!==n.value[e].value)return!1}else return!1;return!0}var g=(t,n,e,i)=>{if(n.length>0){let s=i[t].data;for(let l=0;l<n.length-1;l++)s=s.value[n[l]];e.type==="fire"?s.value.splice(n[n.length-1],1):s.value[n[n.length-1]]=e}else e.type==="fire"?delete i[t]:i[t].data=e};var j=(t,n,e,i,s)=>{let l=e.actions[e.currentAction],a=l[e.currentFragment];if(l.filter(r=>r.type==="operator"&&r.value==="?").length>0){if(e.executeData===void 0){let r={"?":[],":":[]};if(l.forEach((o,p)=>{o.type==="operator"&&(o.value==="?"?r["?"].push({data:o,index:p}):o.value===":"&&r[":"].push({data:o,index:p}))}),r["?"].length>1)return{error:!0,content:"Unexpected <operator>",line:r["?"][0].data.line,start:r["?"][0].data.start};if(r[":"].length>1)return{error:!0,content:"Unexpected <operator>",line:r[":"][0].data.line,start:r[":"][0].data.start};if(l[r["?"][0].index-1]===void 0)return{error:!0,content:"Expecting <anything>",line:r["?"][0].data.line,start:0};if(l[r["?"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>",line:l[r["?"][0].index].line,start:l[r["?"][0].index].end};if(l[r["?"][0].index+1].type!=="actionList")return{error:!0,content:`Unexpected <${l[r["?"][0].index+1].type}>`,line:l[r["?"][0].index+1].line,start:l[r["?"][0].index+1].start};if(r[":"].length>0&&l[r[":"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>"};let u=y(l,o=>o.type==="operator"&&(o.value==="?"||o.value===":"));return u[1].length>1?{error:!0,content:`Unexpected <${u[1][1].type}>`,line:u[1][1].line,start:u[1][1].start}:u.length>2&&u[2].length>1?{error:!0,content:`Unexpected <${u[2][1].type}>`,line:u[2][1].line,start:u[2][1].start}:(e.executeData={type:"gettingCondition",condition:u[0],chunks:u.slice(1,u.length).map(o=>o[0])},n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.condition],!1),{error:!1})}else if(e.executeData.type==="gettingCondition"){if(e.returnedResult.type!=="boolean")return{error:!0,content:`Can Not Perform "If" Operation Using <${e.returnedResult.type}>`,line:e.returnedResult.line,start:e.returnedResult.start};if(e.returnedResult.value==="Yes")return e.executeData.type="waitingActions",n.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[0].value,!1),{error:!1};if(e.executeData.chunks.length>1)return e.executeData.type="waitingActions",n.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[1].value,!1),{error:!1}}else e.executeData.type==="waitingActions"&&(e.result=e.returnedResult);e.currentFragment=l.length,e.executeData=void 0}else if(l.filter(r=>r.type==="operator"&&["=","||","&&","==",">","<","+","-","*","/"].includes(r.value)).length>0)if(e.executeData===void 0){let r;for(let o of["=","||","&&","==",">","<",">=","<=","+","-","*","/"])if(l.filter(p=>p.type==="operator"&&p.value===o).length>0){r=o;break}let u=l.filter(o=>o.type==="operator"&&o.value===r);return u.length>1?{error:!0,content:"Unexpected <operator>",line:u[1].line,start:u[1].start}:(e.executeData={type:r,chunks:y(l,o=>o.type==="operator"&&o.value===r),returnedResults:[]},n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[0]],!1),{error:!1})}else if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=e.executeData.chunks.length){let r=e.executeData.returnedResults;if(e.executeData.type==="="){if(r[0].name===void 0)return{error:!0,content:`<${r[0].type}> Is Not In A Box`,line:r[0].line,start:r[0].start};if(i[r[0].name].lock)return{error:!0,content:`Box Is Locked: "${r[0].name}"`,line:r[0].line,start:r[0].start};g(r[0].name,r[0].path,r[1],i),e.result=r[1]}else if(e.executeData.type==="||"||e.executeData.type==="&&"){if(r[0].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};e.result={type:"boolean",value:(e.executeData.type==="||"?r[0].value==="Yes"||r[1].value==="Yes":r[0].value==="Yes"&&r[1].value==="Yes")?"Yes":"No",line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="==")r[0].type!==r[1].type&&(e.result={type:"boolean",value:"no",line:r[0].line,start:r[0].start,end:r[1].end}),r[0].type==="list"?e.result={type:"boolean",value:L(r[0],r[1])?"yes":"no",line:r[0].line,start:r[0].start,end:r[1].end}:e.result={type:"boolean",value:r[0].value===r[1].value?"yes":"no",line:r[0].line,start:r[0].start,end:r[1].end};else if([">","<",">=","<="].includes(e.executeData.type)){let u;if(e.executeData.type===">"?u="More Than":e.executeData.type==="<"?u="Less Than":e.executeData.type===">="?u="More Than Or Equal To":e.executeData.type==="<="&&(u="Less Than Or Equal To"),r[0].type!=="number")return{error:!0,content:`Cannot Perform "${u}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "${u}" Operation On <${r[1].type}>`,line:r[1].line,start:r[1].start};let o;e.executeData.type===">"?o=+r[0].value>+r[1].value:e.executeData.type==="<"?o=+r[0].value<+r[1].value:e.executeData.type===">="?o=+r[0].value>=+r[1].value:e.executeData.type==="<="&&(o=+r[0].value<=+r[1].value),e.result={type:"boolean",value:o?"Yes":"No",line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="+"){if(r[0].type!=="string"&&r[0].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="string"&&r[1].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};r[0].type==="string"||r[1].type==="string"?e.result={type:"string",value:r[0].value+r[1].value,line:r[0].line,start:r[0].start,end:r[1].end}:e.result={type:"number",value:`${+r[0].value+ +r[1].value}`,line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="*"){if(r[0].type!=="string"&&r[0].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};if(r[0].type==="string"){if(+r[1].value<0)return{error:!0,content:'Cannot Perform "String Multiply" Using <number> Less Than 0',line:r[1].line,start:r[1].start};e.result={type:"string",value:r[0].value.repeat(+r[1].value),line:r[0].line,start:r[0].start,end:r[1].end}}else e.result={type:"number",value:+r[0].value*+r[1].value,line:r[0].line,start:r[0].start,end:r[1].end}}else if(["-","/"].includes(e.executeData.type)){if(r[0].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};let u=e.executeData.type==="-"?+r[0].value-+r[1].value:+r[0].value/+r[1].value;u===1/0?e.result={type:"empty",value:"Empty",line:r[0].line,start:r[0].start,end:r[1].start}:e.result={type:"number",value:`${u}`,line:r[0].line,start:r[0].start,end:r[1].end}}e.currentFragment=l.length,e.executeData=void 0}else return n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[e.executeData.returnedResults.length]],!1),{error:!1};else if(a.type==="operator"&&a.value==="!"){if(e.executeData===void 0)return e.executeData=!0,n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[l.slice(e.currentFragment+1,l.length)],!1),{error:!1};if(e.returnedResult.type!=="boolean")return{error:!0,content:`Cannot Perform "Not" Operation On <${e.returnedResult.type}>`,line:a.line,start:a.line};e.result={type:"boolean",value:e.returnedResult.value==="Yes"?"No":"Yes",line:a.line,start:a.start,end:e.returnedResult.end},e.currentFragment=l.length}else if(a.type==="operator"&&a.value==="~")e.properties.push("async");else if(["string","number","boolean","empty","fire","actionList"].includes(a.type)){if(l.length>e.currentFragment+1)return{error:!0,content:`Unexpected <${l[e.currentFragment+1].type}>`,line:l[e.currentFragment+1].line,start:l[e.currentFragment+1].start};e.result=a}else if(a.type==="name"){if(!["Result","Input"].includes(a.value)&&i[a.value]===void 0&&s[a.value]===void 0)return{error:!0,content:`Box Not Found: "${a.value}"`,line:a.line,start:a.start};let r;a.value==="Result"?r={type:e.lastResult.type,value:e.lastResult.value,line:a.line,start:a.start,end:a.end,name:a.value,path:[]}:a.value==="Input"?r={type:e.input.type,value:e.input.value,line:a.line,start:a.start,end:a.end,name:a.value,path:[]}:r=i[a.value]===void 0?s[a.value]:i[a.value].data,e.result={type:r.type,value:r.value,line:r.line,start:r.start,end:r.end,name:a.value,path:[]}}else if(a.type==="list"||a.type==="inputList"){if(e.executeData===void 0){if(l[e.currentFragment+1]!==void 0&&l[e.currentFragment+1].type!=="inputList")return{error:!0,content:`Unexpected <${l[e.currentFragment+1].type}>`,line:l[e.currentFragment+1].line,start:l[e.currentFragment+1].start};if(e.executeData={state:"gettingItems",returnedResults:[]},a.value.length>0)n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[a.value[0]],!1);else{if(e.result.type==="list")return{error:!0,content:'Cannot Perform "Read" Operation Using <empty>'};e.returnedResult={type:"empty",value:"Empty",line:a.line,start:a.start,end:a.end}}return{error:!1}}else if(e.executeData.state==="gettingItems")if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=a.value.length)if(a.type==="list")e.result={type:"list",value:e.executeData.returnedResults,line:a.line,start:a.start,end:a.end};else{if(e.result.type!=="list"&&e.result.type!=="actionList"&&e.result.type!=="externalFunction")return{error:!0,content:`cannot perform "read" operation on <${e.result.type}>`};if(e.result.type==="list"){if(e.executeData.returnedResults[0].type!=="number"&&e.executeData.returnedResults[0].type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation Using <${e.executeData.returnedResults[0].type}>`,line:a.line,start:a.start};let r=e.result;if(e.executeData.returnedResults[0].type==="number")r=r.value[e.executeData.returnedResults[0].value];else for(let u of e.executeData.returnedResults[0].value){if(r===void 0||r.type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation On <${r===void 0?"empty":r.type}>`,line:u.line,start:u.start};if(u.type!=="number")return{error:!0,content:`Cannot Perform "Read" Operation Using <${u.type}>`,line:u.line,start:u.start};r=r.value[u.value]}r===void 0?(e.result.type="empty",e.result.value="Empty"):(e.result.type=r.type,e.result.value=r.value),e.result.end=a.end,e.result.path&&e.result.path.push(e.executeData.returnedResults[0].value)}else{if(e.result.type==="actionList")return e.executeData.state="waitingActions",n.addChunk(e,{line:a.line},{input:{type:"list",value:e.executeData.returnedResults}},e.result.value,e.properties.includes("async")),{error:!1};if(e.result.type==="externalFunction")return e.executeData.state="waitingExternalFunction",S(t,e,e.result.value,e.executeData.returnedResults,e.properties.includes("async")),{error:!1}}}else return n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[a.value[e.executeData.returnedResults.length]]),{error:!1};else if(e.executeData.state==="waitingActions")e.result=e.returnedResult;else if(e.executeData.state==="waitingExternalFunction"){if(e.returnedResult.error)return{error:!0,content:e.returnedResult.content,line:a.line,start:a.start};e.result={type:e.returnedResult.data.type,value:e.returnedResult.data.value,line:a.line,start:a.start}}e.executeData=void 0}else return{error:!0,content:`Unexpected <${a.type}>`,line:a.line,start:a.start};if(e.currentFragment>=l.length-1)if(e.currentFragment=0,e.currentAction>=e.actions.length-1){let r=n.chunks[e.parentChunk];!e.async&&r!==void 0&&(r.state="running",r.returnedResult=e.result),n.removeChunk(e.id),e.callback!==void 0&&e.callback(e.result)}else e.currentAction++,e.properties=[],e.lastResult=e.result;else e.currentFragment++;return{error:!1}};var b=class{#e=[];#t=0;get tasks(){return this.#e}clear(){this.#e=[],this.#t=0}addTask(t){this.#e.push(t)}removeTask(t){for(;this.#e.includes(t);)this.#e.splice(this.#e.indexOf(t),1)}nextTask(){let t=this.#e[this.#t];return this.#t++,this.#t>=this.#e.length&&(this.#t=0),t}};var B=(t,n,e)=>{let i=[],s=0;if(t[0].type==="operator"&&t[0].value==="+"&&(i.push("create"),t[1].type==="operator"&&t[1].value==="@"?(i.push("lock"),s+=2):s++),t[s]===void 0)return{error:!0,content:"Expecting A <name>",line:t.line,start:0};if(t[s].type!=="name")return{error:!0,content:`Unexpect <${t[s].type}>`,line:t[s].line,start:t[s].start};let l=t[s].value,a=[];if(i.includes("create")){if(t[s+1]!==void 0)return{error:!0,content:`Unexpect <${t[s+1].type}>`,line:t[s+1].line,start:t[s+1].start};if(e[l]!==void 0)return{error:!0,content:`Box Named "${l}" Already Exist (Environment Box)`,line:t[s].line,start:t[s].start};if(n[l]!==void 0)return{error:!0,content:`Box Names "${l}" Already Exist`,line:t[s].line,start:t[s].start};n[l]={lock:i.includes("lock"),data:{type:"empty",value:"Empty"}}}else{if(t[s+1]!==void 0&&t[s+1].type!=="inputList")return{error:!0,content:`Unexpected <${t[s+1].typ}>`,line:t[s+1].line,start:t[s+1].start};if(e[l]!==void 0)return{error:!0,content:`Box Is Locked: "${l}" (Environment Box)`,line:t[s].line,start:t[s].start};if(n[l]===void 0)return{error:`Box Not Found: "${l}"`};if(t[s+1]!==void 0&&t[s+1].type==="inputList"){let u=function(o){if(r===void 0||r.type!=="list")return{error:!0,content:`Cannot Perform "read" Operation On <${r===void 0?"empty":r.type}>`,line:t[s].line,start:t[s].start};if(o.value.length<1)return{error:!0,content:"Expecting A <number>",line:t[s].line,start:t[s].start+1};if(o.value.length>1)return{error:!0,content:`Unexpected <${o.value[1][0].type}>`,line:t[s].value[1][0].line,start:o.value[1][0].start};for(let p of o.value){if(p[0].type!=="number"&&p[0].type!=="name"&&p[0].type!=="list")return{error:!0,content:`Unexpected <${p[0].type}>`,line:p[0].line,start:p[0].start};if(p.length>1)return{error:!0,content:`Unexpected <${p[1].type}>`,line:p[1].line,start:p[1].start}}if(o.value[0][0].type==="number")a.push(o.value[0][0].value),r=r.value[o.value[0][0].value];else if(o.value[0][0].type==="name"){if(n[o.value[0][0].value]===void 0&&e[o.value[0][0].value]===void 0)return{error:!0,content:`Box Not Found: "${o.value[0][0].value}"`,line:o.value[0][0].line,start:o.value[0][0].start};let p=n[o.value[0][0].value]===void 0?e[o.value[0][0].value].data:n[o.value[0][0].value].data;return u({type:"inputList",value:[[p]]})}else for(let p of o.value[0][0].value){if(r.type!=="list")return{error:`Cannot Perform "read" Operation On <${r.type}>`};if(Array.isArray(p)){if(p[0].type!=="number")return{error:!0,content:`Unexpected <${p[0].type}>`,line:p[0].line,start:p[0].start};if(p.length>1)return{error:!0,content:`Unexpected <${p[1].type}>`,line:p[1].line,start:p[1].start};a.push(p[0].value),r=r.value[p[0].value]}else{if(p.type!=="number")return{error:!0,content:`Unexpected <${p.type}>`,line:p.line,start:p.start};a.push(p.value),r=r.value[p.value]}}return{error:!1}};if(n[l].data.type!=="list")return{error:`Cannot Perform "Read" Operation On <${n[l].data.type}>`};s++;let r=n[l].data;for(;t[s]!==void 0&&t[s].type==="inputList";){let o=u(t[s]);if(o.error)return o;s++}}}return{error:!1,name:l,path:a}};var $=class{#e={};#t;#n="idle";#l=new b;#a=new h(this.#l);#r={};#i;#u;#s;constructor(t,n){t=x(I(),t),Object.keys(t).forEach(e=>{if(["Result","Input"].includes(e))throw new Error(`Box Name "${e}" Is Reserved`);this.#e[e]=v(t[e])}),this.#t=x({chunkPerExecution:100,executionInterval:0,keepRunning:!1},n)}get boxes(){return this.#s}async start(t){if(this.#n==="idle")return new Promise(n=>{this.#n="running",this.#l.clear(),this.#a.clear(),this.#s={},this.#r={operations:t,currentOperation:0,globalChunk:this.#a.addChunk(void 0,{name:"<global>"},{},t[0].source,!1),result:{type:"empty",value:"Empty"}},this.#i=setInterval(()=>this.#o(),this.#t.executionInterval),this.#u=n});if(this.#n==="paused")this.#i=setInterval(()=>this.#o(),this.#t.executionInterval);else throw new Error(`Cannot Start Virtual Machine (State: ${this.#n})`)}pause(){if(this.#n==="running")this.#n="paused",clearInterval(this.#i);else throw new Error(`Cannot Pause Virtual Machine (State: ${this.#n})`)}async runActionList(t,n){if(this.#n==="running")return new Promise(e=>{this.#a.addChunk(void 0,void 0,{input:v(n)},t,!1,i=>e(m(this,i)))});throw new Error(`Cannot Run Action List (State: ${this.#n})`)}#o(){for(let t=0;t<this.#t.chunkPerExecution;t++)if(this.#l.tasks.length>0){let n=this.#a.chunks[this.#l.nextTask()];if(n===void 0&&(n=this.#a.chunks[this.#l.nextTask()]),n.state==="running"){let e=j(this,this.#a,n,this.#s,this.#e);if(e.error){this.#n="idle",clearInterval(this.#i),this.#u(e);break}this.#r.result=n.result}if(this.#a.chunks[this.#r.globalChunk]===void 0&&this.#r.currentOperation<this.#r.operations.length-1){let e=B(this.#r.operations[this.#r.currentOperation].target,this.#s,x(this.#e,{Result:n.result,Input:n.input}),this.#r.operations[this.#r.currentOperation].line);if(e.error){this.#n="idle",clearInterval(this.#i),this.#u(e);break}g(e.name,e.path,n.result,this.#s),this.#r.currentOperation++,this.#r.globalChunk=this.#a.addChunk(void 0,{name:"<global>"},{},this.#r.operations[this.#r.currentOperation].source,!1)}}else if(!this.#t.keepRunning){this.#n="idle",clearInterval(this.#i),this.#u(this.#r.result);break}}};var q=(t,n)=>{let e=[],i={},s=0;for(let a=0;a<t.length;a++)if(t[a]==="#"){if(i.type!=="string")return i.type!==void 0&&e.push({type:i.type,value:i.value,line:n,start:i.start,end:a}),{error:!1,fragments:e}}else if(t[a]===" ")i.type!==void 0&&i.type!=="string"&&(e.push({type:i.type,value:i.value,line:n,start:i.start,end:a}),i={});else if("[{(".includes(t[a]))i.type!=="string"&&(i.type!==void 0&&(e.push({type:i.type,value:i.value,line:n,start:i.start,end:a}),i={}),e.push({type:"bracket",value:t[a],line:n,start:a,end:a,layer:s}),s++);else if("]})".includes(t[a]))i.type!=="string"&&(i.type!==void 0&&(e.push({type:i.type,value:i.value,line:n,start:i.start,end:a}),i={}),s--,e.push({type:"bracket",value:t[a],line:n,start:a,end:a,layer:s}));else if(i.type===void 0){let r=a;if(t[a]==="'"||t[a]==='"')i={type:"string",bracket:t[a],value:"",line:n,start:r};else if("0123456789".includes(t[a]))i={type:"number",value:t[a],line:n,start:r};else if(t.substring(a,a+3)==="Yes"||t.substring(a,a+2)==="No"){let u=t.substring(a,a+3)==="Yes"?"Yes":"No";e.push({type:"boolean",value:u,line:n,start:r,end:a+u.length-1}),a+=u.length-1}else t.substring(a,a+5)==="Empty"?(e.push({type:"empty",value:"Empty",line:n,start:r,end:a+4}),a+=4):t.substring(a,a+4)==="Fire"?(e.push({type:"fire",value:"Fire",line:n,start:r,end:a+3}),a+=3):J.includes(t.substring(a,a+2))?(e.push({type:"operator",value:t.substring(a,a+2),line:n,start:r,end:a+1}),a++):J.includes(t[a])?e.push({type:"operator",value:t[a],line:n,start:r,end:a,layer:s}):i={type:"name",value:t[a],line:n,start:a}}else i.type==="string"?t[a]===i.bracket?(e.push({type:"string",value:i.value,line:n,start:i.start,end:a}),i={}):i.value+=t[a]:i.type==="number"?"0123456789.".includes(t[a])?i.value+=t[a]:(e.push({type:"number",value:i.value,line:n,start:i.start,end:a-1}),i={},a--):i.type==="name"&&("+-*/~@!=><|&?:,".includes(t[a])?(e.push({type:"name",value:i.value,line:n,start:i.start,end:a-1}),i={},a--):i.value+=t[a]);if(i.type!==void 0){if(i.type==="string")return{error:!0,content:"<string> Cannot Be Closed",line:n,start:i.start};e.push({type:i.type,value:i.value,line:n,start:i.start,end:t.length-1})}let l=[];for(let a=0;a<e.length;a++)if(e[a].type==="operator"&&e[a].value==="-"&&e[a+1]!==void 0&&e[a+1].type==="number"&&e[a-1]===void 0){for(let r=1;r<e[1].value.length-1;r++)if(e[1].value[r]==="."&&e[1].value[r-1]===".")return{error:!0,content:'Unexpected "."',line:n,start:r};l.push({type:"number",value:`-${e[a+1].value}`,line:n,start:e[a].start,end:e[a+1].end}),a++}else if(e[a].type==="number"){for(let r=1;r<e[0].value.length-1;r++)if(e[0].value[r]==="."&&e[0].value[r-1]===".")return{error:!0,content:'Unexpected "."',line:n,start:r};l.push(e[a])}else l.push(e[a]);return{error:!1,fragments:l}},J=["+","-","*","/","~","@","!","=","==","<",">",">=","<=","||","&&","?",":","<-","->",",","|"];var V=W;function W(t,n){let e=[],i={};for(let s=0;s<t.length;s++)if(i.type===void 0)if(t[s].type==="bracket"&&t[s].value==="[")i={type:"list",bracket:"]",value:[],start:t[s].start,layer:t[s].layer};else if(t[s].type==="bracket"&&t[s].value==="{")i={type:"actionList",bracket:"}",value:[],start:t[s].start,layer:t[s].layer};else if(t[s].type==="bracket"&&t[s].value==="(")i={type:"inputList",bracket:")",value:[],start:t[s].start,layer:t[s].layer};else{if(t[s].type==="bracket")return{error:!0,content:"Unexpected <braket>",line:n,start:t[s].start};e.push(t[s])}else if(t[s].type==="bracket"&&t[s].value===i.bracket&&t[s].layer===i.layer){let l=i.type==="list"||i.type==="inputList"?",":"|";for(let a=1;a<i.value.length;a++)if(i.value[a].type==="operator"&&i.value[a].value===l&&i.value[a].layer===i.layer+1&&i.value[a-1].type!==void 0&&i.value[a-1].type==="operator"&&i.value[a-1].value===l&&i.value[a-1].layer===i.layer+1)return{error:!0,content:`Unexpected "${l}"`,line:n,start:i.value[a].start};if(i.value.length>0){if(i.value[i.value.length-1].type==="operator"&&i.value[i.value.length-1].value===l&&i.value[i.value.length-1].layer===i.layer+1)return{error:!0,content:`Unexpected "${l}"`,line:n,start:i.value[i.value.length-1].start};let a=y(i.value,r=>r.type==="operator"&&r.value===l&&r.layer===i.layer+1);for(let r=0;r<a.length;r++){let u=W(a[r],n);if(u.error)return u;a[r]=u.fragments}e.push({type:i.type,value:a,line:n,start:i.start,end:s})}else e.push({type:i.type,value:[],line:n,start:i.start,end:s});i={}}else i.value.push(t[s]);return i.type!==void 0?{error:!0,content:`<${i.type}> Cannot Be Closed`,line:n,start:i.start}:{error:!1,fragments:e}}var G=(t,n)=>{let e=[],i={};for(let l=0;l<t.length;l++)if(t[l]==="#"){if(i.type!=="string")return i.type!==void 0&&e.push({type:i.type,line:n,start:i.start,end:l}),e.push({type:"comment",line:n,start:l,end:n.length-1}),e}else if(t[l]===" ")i.type!==void 0&&i.type!=="string"&&(e.push({type:i.type,line:n,start:i.start,end:l}),i={});else if("[{(".includes(t[l]))i.type!=="string"&&(i.type!==void 0&&(e.push({type:i.type,line:n,start:i.start,end:l}),i={}),e.push({type:"bracket",line:n,start:l,end:l}));else if("]})".includes(t[l]))i.type!=="string"&&(i.type!==void 0&&(e.push({type:i.type,line:n,start:i.start,end:l}),i={}),e.push({type:"bracket",line:n,start:l,end:l}));else if(i.type===void 0){let a=l;if(t[l]==="'"||t[l]==='"')i={type:"string",bracket:t[l],line:n,start:a};else if("0123456789".includes(t[l]))i={type:"number",line:n,start:a};else if(t.substring(l,l+3)==="Yes"||t.substring(l,l+2)==="No"){let r=t.substring(l,l+3)==="Yes"?"Yes":"No";e.push({type:"boolean",line:n,start:a,end:l+r.length-1}),l+=r.length-1}else t.substring(l,l+5)==="Empty"?(e.push({type:"empty",line:n,start:a,end:l+4}),l+=4):t.substring(l,l+4)==="Fire"?(e.push({type:"fire",line:n,start:a,end:l+3}),l+=3):z.includes(t.substring(l,l+2))?(e.push({type:"operator",line:n,start:a,end:l+1}),l++):z.includes(t[l])?e.push({type:"operator",line:n,start:a,end:l}):i={type:"name",line:n,start:l}}else i.type==="string"?t[l]===i.bracket&&(e.push({type:"string",line:n,start:i.start,end:l}),i={}):i.type==="number"?"0123456789.".includes(t[l])||(e.push({type:"number",line:n,start:i.start,end:l-1}),i={},l--):i.type==="name"&&"+-*/~@!=><|&?:,".includes(t[l])&&(e.push({type:"name",line:n,start:i.start,end:l-1}),i={},l--);i.type!==void 0&&i.type!=="string"&&e.push({type:i.type,value:i.value,line:n,start:i.start,end:t.length-1});let s=[];for(let l=0;l<e.length;l++)e[l].type==="operator"&&e[l].value==="-"&&e[l+1]!==void 0&&e[l+1].type==="number"&&e[l-1]===void 0?(s.push({type:"number",line:n,start:e[l].start,end:e[l+1].end}),l++):s.push(e[l]);return e},z=["+","-","*","/","~","@","!","=","==","<",">",">=","<=","||","&&","?",":","<-","->",",","|"];var O=class{static compile(t){let n=[],e=t.split(`
`);for(let i=0;i<e.length;i++){let s=q(e[i],i+1);if(s.error)return s;if(s.fragments.length>0){if(s=V(s.fragments,i+1),s.error)return s;let l=s.fragments.filter(u=>u.type==="operator"&&(u.value==="<-"||u.value==="->"));if(l<1)return{error:!0,content:"Cannot Found Any Direction",line:i+1};if(l>1)return{error:!0,content:"Too Many Directions",line:i+1};let a=s.fragments.filter(u=>u.type==="operator"&&u.value==="<-").length>0?"<-":"->",r=y(s.fragments,u=>u.type==="operator"&&u.value===a);a==="<-"?n.push({target:r[0],source:y(r[1],u=>u.type==="operator"&&u.value==="|").filter(u=>u.length>0),line:i+1}):n.push({target:r[1],source:y(r[0],u=>u.type==="operator"&&u.value==="|").filter(u=>u.length>0),line:i+1})}}return{error:!1,operations:n}}static highlight(t){let n=[];return t.split(`
`).forEach((e,i)=>n=n.concat(G(e,i))),n}};export{O as Compiler,$ as VirtualMachine};
