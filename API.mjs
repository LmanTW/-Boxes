var m=D;function D(t,n){if(n.type==="string")return n.value;if(n.type==="number")return+n.value;if(n.type==="boolean")return n.value==="Yes";if(n.type!=="empty"){if(n.type==="fire")return null;if(n.type==="list")return n.value.map(e=>D(t,e));if(n.type==="actionList")return async(...e)=>await t.runActionList(n.value,e);if(n.type==="externalFunction")return n.value;if(n.type==="promise")return{type:"promise"};throw new Error(`Unsupported Boxes Data Type <${typeof n}>`)}}var v=C;function C(t){if(typeof t=="string")return{type:"string",value:t};if(typeof t=="number")return{type:"number",value:`${t}`};if(typeof t=="boolean")return{type:"boolean",value:t?"Yes":"No"};if(typeof t>"u")return{type:"empty",value:"Empty"};if(t===null)return{type:"fire",value:"Fire"};if(Array.isArray(t))return{type:"list",value:t.map(n=>C(n))};if(typeof t=="function")return{type:"externalFunction",value:t};if(typeof t=="object"&&t.type==="promise")return{type:"promise",value:""};throw new Error(`Unsupported Javascript Data Type <${typeof t}>`)}var R=t=>{let n={};return w(n,t),n};function w(t,n){Object.keys(n).forEach(e=>{typeof n[e]=="object"?(t[e]===void 0&&(t[e]={}),w(t[e],n[e])):t[e]=n[e]})}var x=P;function P(t,n){return t=R(t),n===void 0||Object.keys(n).forEach(e=>{typeof n[e]=="object"?(typeof t[e]!="object"&&(t[e]={}),t[e]=P(t[e],n[e])):t[e]=n[e]}),t}var A=(t,n)=>Math.floor(Math.random()*n)+t;var c=(t,n)=>{n.length===void 0&&(n=[]);let e=U(t);for(;n.includes(e);)e=U(t);return e};function U(t){let n="";for(let e=0;e<t;e++)n+=E[A(0,E.length-1)];return n}var E="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890";var F=T;function T(t){let n=[];return t.forEach((e,l)=>{Array.isArray(e)?n.push(T(e,l)):n.push(e)}),n}var I=()=>({print:(...t)=>console.log(...t.map(n=>M(n,0))),"String.from":t=>N(t),"String.substring":(t,n,e)=>{if(typeof t!="string")throw`Cannot Perform "Substring" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Substring" Operation Using <${f(n)}> (start)`;if(typeof e!="number")throw`Cannot Perform "Substring" Operation Using <${f(e)}> (end)`;return data.substring(n,e)},"String.replace":(t,n,e)=>{if(typeof t!="string")throw`Cannot Perform "Replace" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Replace" Operation Using <${f(n)}> (pattern)`;if(typeof e!="string")throw`Cannot Perform "Replace" Operation Using <${f(e)}> (replacement)`;return t.replaceAll(n,e)},"String.split":(t,n)=>{if(typeof t!="string")throw`Cannot Perform "Split" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Split" Operation Using <${f(n)}>`;return t.split(n)},"Number.from":t=>{if(typeof t=="string")return isNaN(+t)?void 0:+t;if(typeof t=="number")return t;if(typeof t=="boolean")return+t;if(typeof t>"u"||t===null)return 0;if(Array.isArray(t))return},"Number.toFixed":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "To Fixed" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "To Fixed" Operation Using <${f(n)}> (digits)`;return parseInt(t).toFixed(n)},"List.add":(t,n)=>{if(!Array.isArray(t))throw`Cannot Perform "Add To List" Operation On <${f(t)}>`;return t.concat([n])},"List.insert":(t,n,e)=>{if(!Array.isArray(t))throw`Cannot Perform "Insert To List" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Insert To List" Operation Using <${f(n)}> (index)`;return t=F(t),t.splice(n,0,e),t},"List.join":(t,n)=>{if(!Array.isArray(t))throw`Cannot Perform "Join" Operation On <${f(t)}>`;if(typeof n!="string")throw`Cannot Perform "Join" Operation Using <${f(n)}>`;return t.join(n)},"Math.PI":3.14,"Math.abs":t=>{if(typeof t!="number")throw`Cannot Perform "Absolute" Operation On <${f(t)}>`;return Math.abs(t)},"Math.ceil":t=>{if(typeof t!="number")throw`Cannot Perform "Ceil" Operation On <${f(t)}>`;return Math.ceil(t)},"Math.cos":t=>{if(typeof t!="number")throw`Cannot Perform "Cosine" Operation On <${f(t)}>`;return Math.cos(t)},"Math.floor":t=>{if(typeof t!="number")throw`Cannot Perform "Floor" Operation On <${f(t)}>`;return Math.floor(t)},"Math.pow":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Power" Operation On <${f(t)}>`;if(typeof n!="number")throw`Cannot Perform "Power" Operation Using <${f(n)}>`;return Math.pow(t,n)},"Math.random":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Random" Operation Using <${f(t)}> (min)`;if(typeof n!="number")throw`Cannot Perform "Random" Operation Using <${f(n)}> (max)`;return Math.floor(Math.random()*n)+t},"Math.sin":t=>{if(typeof t!="number")throw`Cannot Perform "Sine" Operation On <${f(t)}>`;return Math.sin(t)},"Math.turnc":t=>{if(typeof t!="number")throw`Cannot Perform "Truncate" Operation On <${f(t)}>`;return Math.trunc(t)},"Timer.wait":async t=>{if(typeof t!="number")throw`Cannot Perform "Wait" Operation Using <${f(t)}>`;return new Promise(n=>{setTimeout(()=>n(),t)})},"Timer.createTimeout":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Create Timeout" Operation Using <${f(t)}>`;if(typeof n!="function")throw`Cannot Perform "Create Timeout" Operation On <${f(n)}>`;let e=c(5,Object.keys(d));return d[e]=setTimeout(()=>{d[e]!==void 0&&(delete d[e],n())},interval),e},"Timer.createInterval":(t,n)=>{if(typeof t!="number")throw`Cannot Perform "Create Interval" Operation Using <${f(t)}>`;if(typeof n!="function")throw`Cannot Perform "Create Interval" Operation On <${f(n)}>`;let e=c(5,Object.keys(d));return d[e]=setInterval(n,t),e},"Date.now":()=>Date.now()});function M(t,n){if(typeof t=="string")return" ".repeat(n*2)+`"${t}"`;if(typeof t=="number")return" ".repeat(n*2)+t;if(typeof t=="boolean")return" ".repeat(n*2)+(t?"Yes":"No");if(typeof t>"u")return" ".repeat(n*2)+"Empty";if(t===null)return" ".repeat(n*2)+"Fire";if(Array.isArray(t)){if(n>1)return" ".repeat(n*2)+`[Array: ${t.length}]`;{let e=t.map(l=>M(l,n+1));return e.length>99?`${" ".repeat(n*2)}[${e.slice(0,99).join(`,
`)}
... ${t.length-99} More
${" ".repeat(n*2)}]`:`${" ".repeat(n*2)}[
${e.join(`,
`)}
${" ".repeat(n*2)}]`}}if(typeof t=="object"&&t.type==="promise")return" ".repeat(n*2)+"[Promise]"}function N(t){if(["string","number"].includes(typeof t))return t.toString();if(typeof t=="boolean")return t?"Yes":"No";if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return`[${t.map(n=>N(n)).join(",")}]`;if(typeof t=="function")return"[Action List]";if(typeof t=="object"&&t.type==="promise")return"[Promise]"}function f(t){if(["string","number","boolean"].includes(typeof t))return typeof t;if(typeof t>"u")return"Empty";if(t===null)return"Fire";if(Array.isArray(t))return"list";if(typeof t=="function")return"actionList";if(typeof t=="object"&&t.type==="promise")return"promise"}var d={};var g=class{#e;#t={};constructor(t){this.#e=t}get chunks(){return this.#t}clear(){this.#t={}}addChunk(t,n,e,l,a,u){let i;t===void 0?i=[]:n===void 0?i=t.callPath:i=t.callPath.concat([n]).slice(0,10);let r=c(5,Object.keys(this.#t));return this.#t[r]={id:r,state:"running",async:a,input:e.input===void 0?{type:"list",value:[],hi:0}:e.input,actions:l,currentAction:0,currentFragment:0,properties:[],result:e.result===void 0?{type:"empty",value:"Empty"}:e.result,lastResult:e.result===void 0?{type:"empty",value:"Empty"}:e.result,returnedResult:void 0,executeData:void 0,parentChunk:t===void 0?void 0:t.id,callPath:i,callback:u},a?t!==void 0&&(t.returnedResult={type:"promise",value:""}):t!==void 0&&(t.state="waiting"),this.#e.addTask(r),r}removeChunk(t){delete this.chunks[t],this.#e.removeTask(t)}};var y=(t,n)=>{let e=[[]];return t.forEach(l=>{n(l)?e.push([]):e[e.length-1].push(l)}),e};var S=(t,n,e,l,a)=>{a?n.returnedResult={type:"promise",value:""}:(n.state="waiting",setTimeout(async()=>{try{let u=await e(...l.map(i=>m(t,i)));n.returnedResult={error:!1,data:v(u)}}catch(u){n.returnedResult={error:!0,content:u.toString()}}n.state="running"},0))};var L=j;function j(t,n){for(let e=0;e<t.value.length;e++)if(t.value[e].type===n.value[e].type){if(t.value[e].type==="list"){if(!j(t.value[e],n.value[e]))return!1}else if(t.value[e].value!==n.value[e].value)return!1}else return!1;return!0}var h=(t,n,e,l)=>{if(n.length>0){let a=l[t].data;for(let u=0;u<n.length-1;u++)a=a.value[n[u]];e.type==="fire"?a.value.splice(n[n.length-1],1):a.value[n[n.length-1]]=e}else e.type==="fire"?delete l[t]:l[t].data=e};var B=(t,n,e,l,a)=>{let u=e.actions[e.currentAction],i=u[e.currentFragment];if(u.filter(r=>r.type==="operator"&&r.value==="?").length>0){if(e.executeData===void 0){let r={"?":[],":":[]};if(u.forEach((o,p)=>{o.type==="operator"&&(o.value==="?"?r["?"].push({data:o,index:p}):o.value===":"&&r[":"].push({data:o,index:p}))}),r["?"].length>1)return{error:!0,content:"Unexpected <operator>",line:r["?"][0].data.line,start:r["?"][0].data.start};if(r[":"].length>1)return{error:!0,content:"Unexpected <operator>",line:r[":"][0].data.line,start:r[":"][0].data.start};if(u[r["?"][0].index-1]===void 0)return{error:!0,content:"Expecting <anything>",line:r["?"][0].data.line,start:0};if(u[r["?"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>",line:u[r["?"][0].index].line,start:u[r["?"][0].index].end};if(u[r["?"][0].index+1].type!=="actionList")return{error:!0,content:`Unexpected <${u[r["?"][0].index+1].type}>`,line:u[r["?"][0].index+1].line,start:u[r["?"][0].index+1].start};if(r[":"].length>0&&u[r[":"][0].index+1]===void 0)return{error:!0,content:"Expecting <actionList>"};let s=y(u,o=>o.type==="operator"&&(o.value==="?"||o.value===":"));return s[1].length>1?{error:!0,content:`Unexpected <${s[1][1].type}>`,line:s[1][1].line,start:s[1][1].start}:s.length>2&&s[2].length>1?{error:!0,content:`Unexpected <${s[2][1].type}>`,line:s[2][1].line,start:s[2][1].start}:(e.executeData={type:"gettingCondition",condition:s[0],chunks:s.slice(1,s.length).map(o=>o[0])},n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.condition],!1),{error:!1})}else if(e.executeData.type==="gettingCondition"){if(e.returnedResult.type!=="boolean")return{error:!0,content:`Can Not Perform "If" Operation Using <${e.returnedResult.type}>`,line:e.returnedResult.line,start:e.returnedResult.start};if(e.returnedResult.value==="Yes")return e.executeData.type="waitingActions",n.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[0].value,!1),{error:!1};if(e.executeData.chunks.length>1)return e.executeData.type="waitingActions",n.addChunk(e,void 0,{result:e.lastResult,input:e.input},e.executeData.chunks[1].value,!1),{error:!1}}else e.executeData.type==="waitingActions"&&(e.result=e.returnedResult);e.currentFragment=u.length,e.executeData=void 0}else if(u.filter(r=>r.type==="operator"&&["=","||","&&","==",">","<","+","-","*","/"].includes(r.value)).length>0)if(e.executeData===void 0){let r;for(let o of["=","||","&&","==",">","<",">=","<=","+","-","*","/"])if(u.filter(p=>p.type==="operator"&&p.value===o).length>0){r=o;break}let s=u.filter(o=>o.type==="operator"&&o.value===r);return s.length>1?{error:!0,content:"Unexpected <operator>",line:s[1].line,start:s[1].start}:(e.executeData={type:r,chunks:y(u,o=>o.type==="operator"&&o.value===r),returnedResults:[]},n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[0]],!1),{error:!1})}else if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=e.executeData.chunks.length){let r=e.executeData.returnedResults;if(e.executeData.type==="="){if(r[0].name===void 0)return{error:!0,content:`<${r[0].type}> Is Not In A Box`,line:r[0].line,start:r[0].start};if(l[r[0].name].lock)return{error:!0,content:`Box Is Locked: "${r[0].name}"`,line:r[0].line,start:r[0].start};h(r[0].name,r[0].path,r[1],l),e.result=r[1]}else if(e.executeData.type==="||"||e.executeData.type==="&&"){if(r[0].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="boolean")return{error:!0,content:`Cannot Perform "${e.executeData.type==="||"?"Or":"And"}" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};e.result={type:"boolean",value:(e.executeData.type==="||"?r[0].value==="Yes"||r[1].value==="Yes":r[0].value==="Yes"&&r[1].value==="Yes")?"Yes":"No",line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="==")r[0].type!==r[1].type&&(e.result={type:"boolean",value:"no",line:r[0].line,start:r[0].start,end:r[1].end}),r[0].type==="list"?e.result={type:"boolean",value:L(r[0],r[1])?"yes":"no",line:r[0].line,start:r[0].start,end:r[1].end}:e.result={type:"boolean",value:r[0].value===r[1].value?"yes":"no",line:r[0].line,start:r[0].start,end:r[1].end};else if([">","<",">=","<="].includes(e.executeData.type)){let s;if(e.executeData.type===">"?s="More Than":e.executeData.type==="<"?s="Less Than":e.executeData.type===">="?s="More Than Or Equal To":e.executeData.type==="<="&&(s="Less Than Or Equal To"),r[0].type!=="number")return{error:!0,content:`Cannot Perform "${s}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "${s}" Operation On <${r[1].type}>`,line:r[1].line,start:r[1].start};let o;e.executeData.type===">"?o=+r[0].value>+r[1].value:e.executeData.type==="<"?o=+r[0].value<+r[1].value:e.executeData.type===">="?o=+r[0].value>=+r[1].value:e.executeData.type==="<="&&(o=+r[0].value<=+r[1].value),e.result={type:"boolean",value:o?"Yes":"No",line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="+"){if(r[0].type!=="string"&&r[0].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="string"&&r[1].type!=="number")return{error:!0,content:`Cannot Perform "Add" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};r[0].type==="string"||r[1].type==="string"?e.result={type:"string",value:r[0].value+r[1].value,line:r[0].line,start:r[0].start,end:r[1].end}:e.result={type:"number",value:`${+r[0].value+ +r[1].value}`,line:r[0].line,start:r[0].start,end:r[1].end}}else if(e.executeData.type==="*"){if(r[0].type!=="string"&&r[0].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "Multiply" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};if(r[0].type==="string"){if(+r[1].value<0)return{error:!0,content:'Cannot Perform "String Multiply" Using <number> Less Than 0',line:r[1].line,start:r[1].start};e.result={type:"string",value:r[0].value.repeat(+r[1].value),line:r[0].line,start:r[0].start,end:r[1].end}}else e.result={type:"number",value:+r[0].value*+r[1].value,line:r[0].line,start:r[0].start,end:r[1].end}}else if(["-","/"].includes(e.executeData.type)){if(r[0].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation On <${r[0].type}>`,line:r[0].line,start:r[0].start};if(r[1].type!=="number")return{error:!0,content:`Cannot Perform "${e.executeData.type==="-"?"Subtract":"Divide"}" Operation Using <${r[1].type}>`,line:r[1].line,start:r[1].start};let s=e.executeData.type==="-"?+r[0].value-+r[1].value:+r[0].value/+r[1].value;s===1/0?e.result={type:"empty",value:"Empty",line:r[0].line,start:r[0].start,end:r[1].start}:e.result={type:"number",value:`${s}`,line:r[0].line,start:r[0].start,end:r[1].end}}e.currentFragment=u.length,e.executeData=void 0}else return n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[e.executeData.chunks[e.executeData.returnedResults.length]],!1),{error:!1};else if(i.type==="operator"&&i.value==="!"){if(e.executeData===void 0)return e.executeData=!0,n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[u.slice(e.currentFragment+1,u.length)],!1),{error:!1};if(e.returnedResult.type!=="boolean")return{error:!0,content:`Cannot Perform "Not" Operation On <${e.returnedResult.type}>`,line:i.line,start:i.line};e.result={type:"boolean",value:e.returnedResult.value==="Yes"?"No":"Yes",line:i.line,start:i.start,end:e.returnedResult.end},e.currentFragment=u.length}else if(i.type==="operator"&&i.value==="~")e.properties.push("async");else if(["string","number","boolean","empty","fire","actionList"].includes(i.type)){if(u.length>e.currentFragment+1)return{error:!0,content:`Unexpected <${u[e.currentFragment+1].type}>`,line:u[e.currentFragment+1].line,start:u[e.currentFragment+1].start};e.result=i}else if(i.type==="name"){if(!["Result","Input"].includes(i.value)&&l[i.value]===void 0&&a[i.value]===void 0)return{error:!0,content:`Box Not Found: "${i.value}"`,line:i.line,start:i.start};let r;i.value==="Result"?r={type:e.lastResult.type,value:e.lastResult.value,line:i.line,start:i.start,end:i.end,name:i.value,path:[]}:i.value==="Input"?r={type:e.input.type,value:e.input.value,line:i.line,start:i.start,end:i.end,name:i.value,path:[]}:r=l[i.value]===void 0?a[i.value]:l[i.value].data,e.result={type:r.type,value:r.value,line:r.line,start:r.start,end:r.end,name:i.value,path:[]}}else if(i.type==="list"||i.type==="inputList"){if(e.executeData===void 0){if(u[e.currentFragment+1]!==void 0&&u[e.currentFragment+1].type!=="inputList")return{error:!0,content:`Unexpected <${u[e.currentFragment+1].type}>`,line:u[e.currentFragment+1].line,start:u[e.currentFragment+1].start};if(e.executeData={state:"gettingItems",returnedResults:[]},i.value.length>0)n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[i.value[0]],!1);else{if(e.result.type==="list")return{error:!0,content:'Cannot Perform "Read" Operation Using <empty>'};e.returnedResult={type:"empty",value:"Empty",line:i.line,start:i.start,end:i.end}}return{error:!1}}else if(e.executeData.state==="gettingItems")if(e.executeData.returnedResults.push(e.returnedResult),e.executeData.returnedResults.length>=i.value.length)if(i.type==="list")e.result={type:"list",value:e.executeData.returnedResults,line:i.line,start:i.start,end:i.end};else{if(e.result.type!=="list"&&e.result.type!=="actionList"&&e.result.type!=="externalFunction")return{error:!0,content:`cannot perform "read" operation on <${e.result.type}>`};if(e.result.type==="list"){if(e.executeData.returnedResults[0].type!=="number"&&e.executeData.returnedResults[0].type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation Using <${e.executeData.returnedResults[0].type}>`,line:i.line,start:i.start};let r=e.result;if(e.executeData.returnedResults[0].type==="number")r=r.value[e.executeData.returnedResults[0].value];else for(let s of e.executeData.returnedResults[0].value){if(r===void 0||r.type!=="list")return{error:!0,content:`Cannot Perform "Read" Operation On <${r===void 0?"empty":r.type}>`,line:s.line,start:s.start};if(s.type!=="number")return{error:!0,content:`Cannot Perform "Read" Operation Using <${s.type}>`,line:s.line,start:s.start};r=r.value[s.value]}r===void 0?(e.result.type="empty",e.result.value="Empty"):(e.result.type=r.type,e.result.value=r.value),e.result.end=i.end,e.result.path&&e.result.path.push(e.executeData.returnedResults[0].value)}else{if(e.result.type==="actionList")return e.executeData.state="waitingActions",n.addChunk(e,{line:i.line},{input:{type:"list",value:e.executeData.returnedResults}},e.result.value,e.properties.includes("async")),{error:!1};if(e.result.type==="externalFunction")return e.executeData.state="waitingExternalFunction",S(t,e,e.result.value,e.executeData.returnedResults,e.properties.includes("async")),{error:!1}}}else return n.addChunk(e,void 0,{result:e.lastResult,input:e.input},[i.value[e.executeData.returnedResults.length]]),{error:!1};else if(e.executeData.state==="waitingActions")e.result=e.returnedResult;else if(e.executeData.state==="waitingExternalFunction"){if(e.returnedResult.error)return{error:!0,content:e.returnedResult.content,line:i.line,start:i.start};e.result={type:e.returnedResult.data.type,value:e.returnedResult.data.value,line:i.line,start:i.start}}e.executeData=void 0}else return{error:!0,content:`Unexpected <${i.type}>`,line:i.line,start:i.start};if(e.currentFragment>=u.length-1)if(e.currentFragment=0,e.currentAction>=e.actions.length-1){let r=n.chunks[e.parentChunk];!e.async&&r!==void 0&&(r.state="running",r.returnedResult=e.result),n.removeChunk(e.id),e.callback!==void 0&&e.callback(e.result)}else e.currentAction++,e.properties=[],e.lastResult=e.result;else e.currentFragment++;return{error:!1}};var $=class{#e=[];#t=0;get tasks(){return this.#e}clear(){this.#e=[],this.#t=0}addTask(t){this.#e.push(t)}removeTask(t){for(;this.#e.includes(t);)this.#e.splice(this.#e.indexOf(t),1)}nextTask(){let t=this.#e[this.#t];return this.#t++,this.#t>=this.#e.length&&(this.#t=0),t}};var Y=(t,n,e)=>{let l=[],a=0;if(t[0].type==="operator"&&t[0].value==="+"&&(l.push("create"),t[1].type==="operator"&&t[1].value==="@"?(l.push("lock"),a+=2):a++),t[a]===void 0)return{error:!0,content:"Expecting A <name>",line:t.line,start:0};if(t[a].type!=="name")return{error:!0,content:`Unexpect <${t[a].type}>`,line:t[a].line,start:t[a].start};let u=t[a].value,i=[];if(l.includes("create")){if(t[a+1]!==void 0)return{error:!0,content:`Unexpect <${t[a+1].type}>`,line:t[a+1].line,start:t[a+1].start};if(e[u]!==void 0)return{error:!0,content:`Box Named "${u}" Already Exist (Environment Box)`,line:t[a].line,start:t[a].start};if(n[u]!==void 0)return{error:!0,content:`Box Names "${u}" Already Exist`,line:t[a].line,start:t[a].start};n[u]={lock:l.includes("lock"),data:{type:"empty",value:"Empty"}}}else{if(t[a+1]!==void 0&&t[a+1].type!=="inputList")return{error:!0,content:`Unexpected <${t[a+1].typ}>`,line:t[a+1].line,start:t[a+1].start};if(e[u]!==void 0)return{error:!0,content:`Box Is Locked: "${u}" (Environment Box)`,line:t[a].line,start:t[a].start};if(n[u]===void 0)return{error:`Box Not Found: "${u}"`};if(t[a+1]!==void 0&&t[a+1].type==="inputList"){let s=function(o){if(r===void 0||r.type!=="list")return{error:!0,content:`Cannot Perform "read" Operation On <${r===void 0?"empty":r.type}>`,line:t[a].line,start:t[a].start};if(o.value.length<1)return{error:!0,content:"Expecting A <number>",line:t[a].line,start:t[a].start+1};if(o.value.length>1)return{error:!0,content:`Unexpected <${o.value[1][0].type}>`,line:t[a].value[1][0].line,start:o.value[1][0].start};for(let p of o.value){if(p[0].type!=="number"&&p[0].type!=="name"&&p[0].type!=="list")return{error:!0,content:`Unexpected <${p[0].type}>`,line:p[0].line,start:p[0].start};if(p.length>1)return{error:!0,content:`Unexpected <${p[1].type}>`,line:p[1].line,start:p[1].start}}if(o.value[0][0].type==="number")i.push(o.value[0][0].value),r=r.value[o.value[0][0].value];else if(o.value[0][0].type==="name"){if(n[o.value[0][0].value]===void 0&&e[o.value[0][0].value]===void 0)return{error:!0,content:`Box Not Found: "${o.value[0][0].value}"`,line:o.value[0][0].line,start:o.value[0][0].start};let p=n[o.value[0][0].value]===void 0?e[o.value[0][0].value].data:n[o.value[0][0].value].data;return s({type:"inputList",value:[[p]]})}else for(let p of o.value[0][0].value){if(r.type!=="list")return{error:`Cannot Perform "read" Operation On <${r.type}>`};if(Array.isArray(p)){if(p[0].type!=="number")return{error:!0,content:`Unexpected <${p[0].type}>`,line:p[0].line,start:p[0].start};if(p.length>1)return{error:!0,content:`Unexpected <${p[1].type}>`,line:p[1].line,start:p[1].start};i.push(p[0].value),r=r.value[p[0].value]}else{if(p.type!=="number")return{error:!0,content:`Unexpected <${p.type}>`,line:p.line,start:p.start};i.push(p.value),r=r.value[p.value]}}return{error:!1}};if(n[u].data.type!=="list")return{error:`Cannot Perform "Read" Operation On <${n[u].data.type}>`};a++;let r=n[u].data;for(;t[a]!==void 0&&t[a].type==="inputList";){let o=s(t[a]);if(o.error)return o;a++}}}return{error:!1,name:u,path:i}};var b=class{#e={};#t;#n="idle";#a=new $;#i=new g(this.#a);#r={};#l;#s;#u;constructor(t,n){t=x(I(),t),Object.keys(t).forEach(e=>{if(["Result","Input"].includes(e))throw new Error(`Box Name "${e}" Is Reserved`);this.#e[e]=v(t[e])}),this.#t=x({chunkPerExecution:100,executionInterval:0,keepRunning:!1},n)}get boxes(){return this.#u}async start(t){if(this.#n==="idle")return new Promise(n=>{this.#n="running",this.#a.clear(),this.#i.clear(),this.#u={},this.#r={operations:t,currentOperation:0,globalChunk:this.#i.addChunk(void 0,{name:"<global>"},{},t[0].source,!1),result:{type:"empty",value:"Empty"}},this.#l=setInterval(()=>this.#o(),this.#t.executionInterval),this.#s=n});if(this.#n==="paused")this.#l=setInterval(()=>this.#o(),this.#t.executionInterval);else throw new Error(`Cannot Start Virtual Machine (State: ${this.#n})`)}pause(){if(this.#n==="running")this.#n="paused",clearInterval(this.#l);else throw new Error(`Cannot Pause Virtual Machine (State: ${this.#n})`)}async runActionList(t,n){if(this.#n==="running")return new Promise(e=>{this.#i.addChunk(void 0,void 0,{input:v(n)},t,!1,l=>e(m(this,l)))});throw new Error(`Cannot Run Action List (State: ${this.#n})`)}#o(){for(let t=0;t<this.#t.chunkPerExecution;t++)if(this.#a.tasks.length>0){let n=this.#i.chunks[this.#a.nextTask()];if(n===void 0&&(n=this.#i.chunks[this.#a.nextTask()]),n.state==="running"){let e=B(this,this.#i,n,this.#u,this.#e);if(e.error){this.#n="idle",clearInterval(this.#l),this.#s(e);break}this.#r.result=n.result}if(this.#i.chunks[this.#r.globalChunk]===void 0&&this.#r.currentOperation<this.#r.operations.length-1){let e=Y(this.#r.operations[this.#r.currentOperation].target,this.#u,x(this.#e,{Result:n.result,Input:n.input}),this.#r.operations[this.#r.currentOperation].line);if(e.error){this.#n="idle",clearInterval(this.#l),this.#s(e);break}h(e.name,e.path,n.result,this.#u),this.#r.currentOperation++,this.#r.globalChunk=this.#i.addChunk(void 0,{name:"<global>"},{},this.#r.operations[this.#r.currentOperation].source,!1)}}else if(!this.#t.keepRunning){this.#n="idle",clearInterval(this.#l),this.#s(this.#r.result);break}}};var q=(t,n)=>{let e=[],l={},a=0;for(let i=0;i<t.length;i++)if(t[i]==="#"){if(l.type!=="string")return l.type!==void 0&&e.push({type:l.type,value:l.value,line:n,start:l.start,end:i}),{error:!1,fragments:e}}else if(t[i]===" ")l.type!==void 0&&l.type!=="string"&&(e.push({type:l.type,value:l.value,line:n,start:l.start,end:i}),l={});else if("[{(".includes(t[i]))l.type!=="string"&&(l.type!==void 0&&(e.push({type:l.type,value:l.value,line:n,start:l.start,end:i}),l={}),e.push({type:"bracket",value:t[i],line:n,start:i,end:i,layer:a}),a++);else if("]})".includes(t[i]))l.type!=="string"&&(l.type!==void 0&&(e.push({type:l.type,value:l.value,line:n,start:l.start,end:i}),l={}),a--,e.push({type:"bracket",value:t[i],line:n,start:i,end:i,layer:a}));else if(l.type===void 0){let r=i;if(t[i]==="'"||t[i]==='"')l={type:"string",bracket:t[i],value:"",line:n,start:r};else if("0123456789".includes(t[i]))l={type:"number",value:t[i],line:n,start:r};else if(t.substring(i,i+3)==="Yes"||t.substring(i,i+2)==="No"){let s=t.substring(i,i+3)==="Yes"?"Yes":"No";e.push({type:"boolean",value:s,line:n,start:r,end:i+s.length-1}),i+=s.length-1}else t.substring(i,i+5)==="Empty"?(e.push({type:"empty",value:"Empty",line:n,start:r,end:i+4}),i+=4):t.substring(i,i+4)==="Fire"?(e.push({type:"fire",value:"Fire",line:n,start:r,end:i+3}),i+=3):J.includes(t.substring(i,i+2))?(e.push({type:"operator",value:t.substring(i,i+2),line:n,start:r,end:i+1}),i++):J.includes(t[i])?e.push({type:"operator",value:t[i],line:n,start:r,end:i,layer:a}):l={type:"name",value:t[i],line:n,start:i}}else l.type==="string"?t[i]===l.bracket?(e.push({type:"string",value:l.value,line:n,start:l.start,end:i}),l={}):l.value+=t[i]:l.type==="number"?"0123456789.".includes(t[i])?l.value+=t[i]:(e.push({type:"number",value:l.value,line:n,start:l.start,end:i-1}),l={},i--):l.type==="name"&&("+-*/~@!=><|&?:,".includes(t[i])?(e.push({type:"name",value:l.value,line:n,start:l.start,end:i-1}),l={},i--):l.value+=t[i]);if(l.type!==void 0){if(l.type==="string")return{error:!0,content:"<string> Cannot Be Closed",line:n,start:l.start};e.push({type:l.type,value:l.value,line:n,start:l.start,end:t.length-1})}let u=[];for(let i=0;i<e.length;i++)if(e[i].type==="operator"&&e[i].value==="-"&&e[i+1]!==void 0&&e[i+1].type==="number"&&e[i-1]===void 0){for(let r=1;r<e[1].value.length-1;r++)if(e[1].value[r]==="."&&e[1].value[r-1]===".")return{error:!0,content:'Unexpected "."',line:n,start:r};u.push({type:"number",value:`-${e[i+1].value}`,line:n,start:e[i].start,end:e[i+1].end}),i++}else if(e[i].type==="number"){for(let r=1;r<e[0].value.length-1;r++)if(e[0].value[r]==="."&&e[0].value[r-1]===".")return{error:!0,content:'Unexpected "."',line:n,start:r};u.push(e[i])}else u.push(e[i]);return{error:!1,fragments:u}},J=["+","-","*","/","~","@","!","=","==","<",">",">=","<=","||","&&","?",":","<-","->",",","|"];var V=W;function W(t,n){let e=[],l={};for(let a=0;a<t.length;a++)if(l.type===void 0)if(t[a].type==="bracket"&&t[a].value==="[")l={type:"list",bracket:"]",value:[],start:t[a].start,layer:t[a].layer};else if(t[a].type==="bracket"&&t[a].value==="{")l={type:"actionList",bracket:"}",value:[],start:t[a].start,layer:t[a].layer};else if(t[a].type==="bracket"&&t[a].value==="(")l={type:"inputList",bracket:")",value:[],start:t[a].start,layer:t[a].layer};else{if(t[a].type==="bracket")return{error:!0,content:"Unexpected <braket>",line:n,start:t[a].start};e.push(t[a])}else if(t[a].type==="bracket"&&t[a].value===l.bracket&&t[a].layer===l.layer){let u=l.type==="list"||l.type==="inputList"?",":"|";for(let i=1;i<l.value.length;i++)if(l.value[i].type==="operator"&&l.value[i].value===u&&l.value[i].layer===l.layer+1&&l.value[i-1].type!==void 0&&l.value[i-1].type==="operator"&&l.value[i-1].value===u&&l.value[i-1].layer===l.layer+1)return{error:!0,content:`Unexpected "${u}"`,line:n,start:l.value[i].start};if(l.value.length>0){if(l.value[l.value.length-1].type==="operator"&&l.value[l.value.length-1].value===u&&l.value[l.value.length-1].layer===l.layer+1)return{error:!0,content:`Unexpected "${u}"`,line:n,start:l.value[l.value.length-1].start};let i=y(l.value,r=>r.type==="operator"&&r.value===u&&r.layer===l.layer+1);for(let r=0;r<i.length;r++){let s=W(i[r],n);if(s.error)return s;i[r]=s.fragments}e.push({type:l.type,value:i,line:n,start:l.start,end:a})}else e.push({type:l.type,value:[],line:n,start:l.start,end:a});l={}}else l.value.push(t[a]);return l.type!==void 0?{error:!0,content:`<${l.type}> Cannot Be Closed`,line:n,start:l.start}:{error:!1,fragments:e}}var O=class{static compile(t){let n=[],e=t.split(`
`);for(let l=0;l<e.length;l++){let a=q(e[l],l+1);if(a.error)return a;if(a.fragments.length>0){if(a=V(a.fragments,l+1),a.error)return a;let u=a.fragments.filter(s=>s.type==="operator"&&(s.value==="<-"||s.value==="->"));if(u<1)return{error:!0,content:"Cannot Found Any Direction",line:l+1};if(u>1)return{error:!0,content:"Too Many Directions",line:l+1};let i=a.fragments.filter(s=>s.type==="operator"&&s.value==="<-").length>0?"<-":"->",r=y(a.fragments,s=>s.type==="operator"&&s.value===i);i==="<-"?n.push({target:r[0],source:y(r[1],s=>s.type==="operator"&&s.value==="|").filter(s=>s.length>0),line:l+1}):n.push({target:r[1],source:y(r[0],s=>s.type==="operator"&&s.value==="|").filter(s=>s.length>0),line:l+1})}}return{error:!1,operations:n}}};export{O as Compiler,b as VirtualMachine};
